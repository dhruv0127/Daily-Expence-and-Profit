"use strict";import PlotLineOrBandAxis from"./PlotLineOrBandAxis.js";import U from"../../Utilities.js";const{arrayMax,arrayMin,defined,destroyObjectProperties,erase,fireEvent,merge,objectEach,pick}=U;class PlotLineOrBand{static compose(e){return PlotLineOrBandAxis.compose(PlotLineOrBand,e)}constructor(e,t){this.axis=e,t&&(this.options=t,this.id=t.id)}render(){fireEvent(this,"render");const i=this,e=i.axis,t=e.horiz,r=e.logarithmic,a=i.options,s=a.color,n=pick(a.zIndex,0),l=a.events,d={},o=e.chart.renderer;let h=a.label,c=i.label,g=a.to,f=a.from,p=a.value,x=i.svgElem,m=[],y;const b=defined(f)&&defined(g),u=defined(p),L=!x,P={class:"highcharts-plot-"+(b?"band ":"line ")+(a.className||"")};var v=b?"bands":"lines";if(r&&(f=r.log2lin(f),g=r.log2lin(g),p=r.log2lin(p)),e.chart.styledMode||(u?(P.stroke=s||"#999999",P["stroke-width"]=pick(a.width,1),a.dashStyle&&(P.dashstyle=a.dashStyle)):b&&(P.fill=s||"#e6e9ff",a.borderWidth&&(P.stroke=a.borderColor,P["stroke-width"]=a.borderWidth))),v+="-"+(d.zIndex=n),(y=e.plotLinesAndBandsGroups[v])||(e.plotLinesAndBandsGroups[v]=y=o.g("plot-"+v).attr(d).add()),L&&(i.svgElem=x=o.path().attr(P).add(y)),u)m=e.getPlotLinePath({value:p,lineWidth:x.strokeWidth(),acrossPanes:a.acrossPanes});else{if(!b)return;m=e.getPlotBandPath(f,g,a)}return!i.eventsAdded&&l&&(objectEach(l,function(e,t){x.on(t,function(e){l[t].apply(i,[e])})}),i.eventsAdded=!0),(L||!x.d)&&m&&m.length?x.attr({d:m}):x&&(m?(x.show(),x.animate({d:m})):x.d&&(x.hide(),c&&(i.label=c=c.destroy()))),h&&(defined(h.text)||defined(h.formatter))&&m&&m.length&&0<e.width&&0<e.height&&!m.isFlat?(h=merge({align:t&&b&&"center",x:t?!b&&4:10,verticalAlign:!t&&b&&"middle",y:t?b?16:10:b?6:-4,rotation:t&&!b&&90},h),this.renderLabel(h,m,b,n)):c&&c.hide(),i}renderLabel(e,t,i,r){const a=this,s=a.axis,n=s.chart.renderer;let l=a.label;l||(a.label=l=n.text(this.getLabelText(e),0,0,e.useHTML).attr({align:e.textAlign||e.align,rotation:e.rotation,class:"highcharts-plot-"+(i?"band":"line")+"-label "+(e.className||""),zIndex:r}).add(),s.chart.styledMode||l.css(merge({fontSize:"0.8em",textOverflow:"ellipsis"},e.style)));var r=t.xBounds||[t[0][1],t[1][1],(i?t[2]:t[0])[1]],i=t.yBounds||[t[0][2],t[1][2],(i?t[2]:t[0])[2]],t=arrayMin(r),d=arrayMin(i);l.align(e,!1,{x:t,y:d,width:arrayMax(r)-t,height:arrayMax(i)-d}),l.alignValue&&"left"!==l.alignValue||(r=e.clip?s.width:s.chart.chartWidth,l.css({width:(90===l.rotation?s.height-(l.alignAttr.y-s.top):r-(l.alignAttr.x-s.left))+"px"})),l.show(!0)}getLabelText(e){return defined(e.formatter)?e.formatter.call(this):e.text}destroy(){erase(this.axis.plotLinesAndBands,this),delete this.axis,destroyObjectProperties(this)}}export default PlotLineOrBand;