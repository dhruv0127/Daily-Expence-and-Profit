"use strict";import AST from"../Renderer/HTML/AST.js";import A from"../Animation/AnimationUtilities.js";const animObject=A["animObject"];import D from"../Defaults.js";const defaultOptions=D["defaultOptions"];import F from"../FormatUtilities.js";const format=F["format"];import U from"../Utilities.js";const{addEvent,defined,erase,extend,fireEvent,getNestedProperty,isArray,isFunction,isNumber,isObject,merge,objectEach,pick,syncTimeout,removeEvent,uniqueKey}=U;class Point{constructor(){this.category=void 0,this.destroyed=!1,this.formatPrefix="point",this.id=void 0,this.isNull=!1,this.name=void 0,this.options=void 0,this.percentage=void 0,this.selected=!1,this.series=void 0,this.shapeArgs=void 0,this.total=void 0,this.visible=!0,this.x=void 0}animateBeforeDestroy(){const o=this,i={x:o.startXPos,opacity:0},t=o.getGraphicalProps();t.singular.forEach(function(t){var e="dataLabel"===t;o[t]=o[t].animate(e?{x:o[t].startXPos,y:o[t].startYPos,opacity:0}:i)}),t.plural.forEach(function(t){o[t].forEach(function(t){t.element&&t.animate(extend({x:o.startXPos},t.startYPos?{x:t.startXPos,y:t.startYPos}:{}))})})}applyOptions(t,e){const o=this,i=o.series,s=i.options.pointValKey||i.pointValKey;return t=Point.prototype.optionsToObject.call(this,t),extend(o,t),o.options=o.options?extend(o.options,t):t,t.group&&delete o.group,t.dataLabels&&delete o.dataLabels,s&&(o.y=Point.prototype.getNestedProperty.call(o,s)),o.isNull=this.isValid&&!this.isValid(),o.formatPrefix=o.isNull?"null":"point",o.selected&&(o.state="select"),"name"in o&&void 0===e&&i.xAxis&&i.xAxis.hasNames&&(o.x=i.xAxis.nameToX(o)),void 0===o.x&&i?o.x=void 0===e?i.autoIncrement():e:isNumber(t.x)&&i.options.relativeXValue&&(o.x=i.autoIncrement(t.x)),o}destroy(){if(!this.destroyed){const e=this,o=e.series,i=o.chart,s=o.options.dataSorting,r=i.hoverPoints,a=e.series.chart.renderer.globalAnimation,n=animObject(a);var t=()=>{(e.graphic||e.graphics||e.dataLabel||e.dataLabels)&&(removeEvent(e),e.destroyElements());for(const t in e)delete e[t]};e.legendItem&&i.legend.destroyItem(e),r&&(e.setState(),erase(r,e),r.length||(i.hoverPoints=null)),e===i.hoverPoint&&e.onMouseOut(),s&&s.enabled?(this.animateBeforeDestroy(),syncTimeout(t,n.duration)):t(),i.pointCount--}this.destroyed=!0}destroyElements(t){const e=this,o=e.getGraphicalProps(t);o.singular.forEach(function(t){e[t]=e[t].destroy()}),o.plural.forEach(function(t){e[t].forEach(function(t){t&&t.element&&t.destroy()}),delete e[t]})}firePointEvent(t,e,o){const i=this,s=this.series,r=s.options;(r.point.events[t]||i.options&&i.options.events&&i.options.events[t])&&i.importEvents(),"click"===t&&r.allowPointSelect&&(o=function(t){i.select&&i.select(null,t.ctrlKey||t.metaKey||t.shiftKey)}),fireEvent(i,t,e,o)}getClassName(){var t=this;return"highcharts-point"+(t.selected?" highcharts-point-select":"")+(t.negative?" highcharts-negative":"")+(t.isNull?" highcharts-null-point":"")+(void 0!==t.colorIndex?" highcharts-color-"+t.colorIndex:"")+(t.options.className?" "+t.options.className:"")+(t.zone&&t.zone.className?" "+t.zone.className.replace("highcharts-negative",""):"")}getGraphicalProps(o){const i=this,t=[],s={singular:[],plural:[]};let e,r;for((o=o||{graphic:1,dataLabel:1}).graphic&&t.push("graphic"),o.dataLabel&&t.push("dataLabel","dataLabelPath","dataLabelUpper","connector"),r=t.length;r--;)e=t[r],i[e]&&s.singular.push(e);return["graphic","dataLabel","connector"].forEach(function(t){var e=t+"s";o[t]&&i[e]&&s.plural.push(e)}),s}getLabelConfig(){return{x:this.category,y:this.y,color:this.color,colorIndex:this.colorIndex,key:this.name||this.category,series:this.series,point:this,percentage:this.percentage,total:this.total||this.stackTotal}}getNestedProperty(t){if(t)return 0===t.indexOf("custom.")?getNestedProperty(t,this.options):this[t]}getZone(){var t=this.series,e=t.zones,o=t.zoneAxis||"y";let i,s=0;for(i=e[s];this[o]>=i.value;)i=e[++s];return this.nonZonedColor||(this.nonZonedColor=this.color),i&&i.color&&!this.options.color?this.color=i.color:this.color=this.nonZonedColor,i}hasNewShapeType(){var t=this;return(t.graphic&&(t.graphic.symbolName||t.graphic.element.nodeName))!==this.shapeType}init(t,e,o){return this.series=t,this.applyOptions(e,o),this.id=defined(this.id)?this.id:uniqueKey(),this.resolveColor(),t.chart.pointCount++,fireEvent(this,"afterInit"),this}isValid(){return null!==this.x&&isNumber(this.y)}optionsToObject(t){const e=this.series,o=e.options.keys,i=o||e.pointArrayMap||["y"],s=i.length;let r={},a,n=0,l=0;if(isNumber(t)||null===t)r[i[0]]=t;else if(isArray(t))for(!o&&t.length>s&&("string"==(a=typeof t[0])?r.name=t[0]:"number"==a&&(r.x=t[0]),n++);l<s;)o&&void 0===t[n]||(0<i[l].indexOf(".")?Point.prototype.setNestedProperty(r,t[n],i[l]):r[i[l]]=t[n]),n++,l++;else"object"==typeof t&&((r=t).dataLabels&&(e._hasPointLabels=!0),t.marker&&(e._hasPointMarkers=!0));return r}pos(o,i=this.plotY){if(!this.destroyed){var{plotX:s,series:r}=this,{chart:r,xAxis:a,yAxis:n}=r;let t=0,e=0;if(isNumber(s)&&isNumber(i))return o&&(t=a?a.pos:r.plotLeft,e=n?n.pos:r.plotTop),r.inverted&&a&&n?[n.len-i+e,a.len-s+t]:[s+t,i+e]}}resolveColor(){const t=this.series,e=t.chart.options.chart,o=t.chart.styledMode;let i,s,r=e.colorCount,a;delete this.nonZonedColor,t.options.colorByPoint?(o||(s=t.options.colors||t.chart.options.colors,i=s[t.colorCounter],r=s.length),a=t.colorCounter,t.colorCounter++,t.colorCounter===r&&(t.colorCounter=0)):(o||(i=t.color),a=t.colorIndex),this.colorIndex=pick(this.options.colorIndex,a),this.color=pick(this.options.color,i)}setNestedProperty(t,s,e){const o=e.split(".");return o.reduce(function(t,e,o,i){i=i.length-1===o;return t[e]=i?s:isObject(t[e],!0)?t[e]:{},t[e]},t),t}shouldDraw(){return!this.isNull}tooltipFormatter(e){const t=this.series,o=t.tooltipOptions,i=pick(o.valueDecimals,""),s=o.valuePrefix||"",r=o.valueSuffix||"";return t.chart.styledMode&&(e=t.chart.tooltip.styledModeFormat(e)),(t.pointArrayMap||["y"]).forEach(function(t){t="{point."+t,e=(e=s||r?e.replace(RegExp(t+"}","g"),s+t+"}"+r):e).replace(RegExp(t+"}","g"),t+":,."+i+"f}")}),format(e,{point:this,series:this.series},t.chart)}update(e,o,i,t){const s=this,r=s.series,a=s.graphic,n=r.chart,l=r.options;let c;function h(){s.applyOptions(e);var t=a&&s.hasMockGraphic,t=null===s.y?!t:t;a&&t&&(s.graphic=a.destroy(),delete s.hasMockGraphic),isObject(e,!0)&&(a&&a.element&&e&&e.marker&&void 0!==e.marker.symbol&&(s.graphic=a.destroy()),e&&e.dataLabels&&s.dataLabel&&(s.dataLabel=s.dataLabel.destroy()),s.connector&&(s.connector=s.connector.destroy())),c=s.index,r.updateParallelArrays(s,c),l.data[c]=isObject(l.data[c],!0)||isObject(e,!0)?s.options:pick(e,l.data[c]),r.isDirty=r.isDirtyData=!0,!r.fixedBox&&r.hasCartesianSeries&&(n.isDirtyBox=!0),"point"===l.legendType&&(n.isDirtyLegend=!0),o&&n.redraw(i)}o=pick(o,!0),!1===t?h():s.firePointEvent("update",{options:e},h)}remove(t,e){this.series.removePoint(this.series.data.indexOf(this),t,e)}select(t,e){const o=this,i=o.series,s=i.chart;t=pick(t,!o.selected),this.selectedStaging=t,o.firePointEvent(t?"select":"unselect",{accumulate:e},function(){o.selected=o.options.selected=t,i.options.data[i.data.indexOf(o)]=o.options,o.setState(t&&"select"),e||s.getSelectedPoints().forEach(function(t){const e=t.series;t.selected&&t!==o&&(t.selected=t.options.selected=!1,e.options.data[e.data.indexOf(t)]=t.options,t.setState(s.hoverPoints&&e.options.inactiveOtherPoints?"inactive":""),t.firePointEvent("unselect"))})}),delete this.selectedStaging}onMouseOver(t){const e=this.series,o=e.chart,i=o.pointer;t=t?i.normalize(t):i.getChartCoordinatesFromPoint(this,o.inverted),i.runPointActions(t,this)}onMouseOut(){const t=this.series.chart;this.firePointEvent("mouseOut"),this.series.options.inactiveOtherPoints||(t.hoverPoints||[]).forEach(function(t){t.setState()}),t.hoverPoints=t.hoverPoint=null}importEvents(){if(!this.hasImportedEvents){const o=this,t=merge(o.series.options.point,o.options),e=t.events;o.events=e,objectEach(e,function(t,e){isFunction(t)&&addEvent(o,e,t)}),this.hasImportedEvents=!0}}setState(t,e){const o=this,i=o.series,s=o.state,r=i.options.states[t||"normal"]||{},a=defaultOptions.plotOptions[i.type].marker&&i.options.marker,n=a&&!1===a.enabled,l=a&&a.states&&a.states[t||"normal"]||{},c=!1===l.enabled,h=o.marker||{},p=i.chart,d=a&&i.markerAttribs;let u=i.halo,m,y,f,g=i.stateMarkerGraphic,v;if(!((t=t||"")===o.state&&!e||o.selected&&"select"!==t||!1===r.enabled||t&&(c||n&&!1===l.enabled)||t&&h.states&&h.states[t]&&!1===h.states[t].enabled)){if(o.state=t,d&&(m=i.markerAttribs(o,t)),o.graphic&&!o.hasMockGraphic){if(s&&o.graphic.removeClass("highcharts-point-"+s),t&&o.graphic.addClass("highcharts-point-"+t),!p.styledMode){y=i.pointAttribs(o,t),f=pick(p.options.chart.animation,r.animation);const E=y.opacity;i.options.inactiveOtherPoints&&isNumber(E)&&((o.dataLabels||[]).forEach(function(t){t&&!t.hasClass("highcharts-data-label-hidden")&&t.animate({opacity:E},f)}),o.connector&&o.connector.animate({opacity:E},f)),o.graphic.animate(y,f)}m&&o.graphic.animate(m,pick(p.options.chart.animation,l.animation,a.animation)),g&&g.hide()}else t&&l&&(v=h.symbol||i.symbol,g&&g.currentSymbol!==v&&(g=g.destroy()),m&&(g?g[e?"animate":"attr"]({x:m.x,y:m.y}):v&&(i.stateMarkerGraphic=g=p.renderer.symbol(v,m.x,m.y,m.width,m.height).add(i.markerGroup),g.currentSymbol=v)),!p.styledMode&&g&&"inactive"!==o.state&&g.attr(i.pointAttribs(o,t))),g&&(g[t&&o.isInside?"show":"hide"](),g.element.point=o,g.addClass(o.getClassName(),!0));var b=r.halo,x=o.graphic||g,P=x&&x.visibility||"inherit";b&&b.size&&x&&"hidden"!==P&&!o.isCluster?(u||(i.halo=u=p.renderer.path().add(x.parentGroup)),u.show()[e?"animate":"attr"]({d:o.haloPath(b.size)}),u.attr({class:"highcharts-halo highcharts-color-"+pick(o.colorIndex,i.colorIndex)+(o.className?" "+o.className:""),visibility:P,zIndex:-1}),u.point=o,p.styledMode||u.attr(extend({fill:o.color||i.color,"fill-opacity":b.opacity},AST.filterUserAttributes(b.attributes||{})))):u&&u.point&&u.point.haloPath&&u.animate({d:u.point.haloPath(0)},null,u.hide),fireEvent(o,"afterSetState",{state:t})}}haloPath(t){var e=this.pos();return e?this.series.chart.renderer.symbols.circle(Math.floor(e[0])-t,e[1]-t,2*t,2*t):[]}}export default Point;