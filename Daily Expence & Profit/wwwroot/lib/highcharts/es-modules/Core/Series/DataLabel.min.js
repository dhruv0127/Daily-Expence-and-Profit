"use strict";import A from"../Animation/AnimationUtilities.js";const getDeferredAnimation=A["getDeferredAnimation"];import F from"../FormatUtilities.js";const format=F["format"];import U from"../Utilities.js";const{defined,extend,fireEvent,isArray,isString,merge,objectEach,pick,splat}=U;var DataLabel;!function(t){const a=[];function i(e,a,i,o,r){const s=this,n=this.chart,t=this.isCartesian&&n.inverted,l=this.enabledDataSorting,d=e.plotX,c=e.plotY,h=i.rotation,p=i.align,b=defined(d)&&defined(c)&&n.isInsidePlot(d,Math.round(c),{inverted:t,paneCoordinates:!0,series:s}),f=t=>{l&&s.xAxis&&!y&&s.setDataLabelStartPos(e,a,r,b,t)};let g,u,L,y="justify"===pick(i.overflow,l?"none":"justify"),m=this.visible&&!1!==e.visible&&defined(d)&&(e.series.forceDL||l&&!y||b||pick(i.inside,!!this.options.stacking)&&o&&n.isInsidePlot(d,t?o.x+1:o.y+o.height-1,{inverted:t,paneCoordinates:!0,series:s}));var x,v=e.pos();if(m&&v){h&&a.attr({align:p});let t=a.getBBox(!0),e=[0,0];g=n.renderer.fontMetrics(a).b,o=extend({x:v[0],y:Math.round(v[1]),width:0,height:0},o),extend(i,{width:t.width,height:t.height}),h?(y=!1,u=n.renderer.rotCorr(g,h),L={x:o.x+(i.x||0)+o.width/2+u.x,y:o.y+(i.y||0)+{top:0,middle:.5,bottom:1}[i.verticalAlign]*o.height},e=[t.x-Number(a.attr("x")),t.y-Number(a.attr("y"))],f(L),a[r?"attr":"animate"](L)):(f(o),a.align(i,void 0,o),L=a.alignAttr),y&&0<=o.height?this.justifyDataLabel(a,i,L,t,o,r):pick(i.crop,!0)&&({x:o,y:x}=L,o+=e[0],x+=e[1],m=n.isInsidePlot(o,x,{paneCoordinates:!0,series:s})&&n.isInsidePlot(o+t.width,x+t.height,{paneCoordinates:!0,series:s})),i.shape&&!h&&a[r?"attr":"animate"]({anchorX:v[0],anchorY:v[1]})}r&&l&&(a.placed=!1),m||l&&!y?a.show():(a.hide(),a.placed=!1)}function o(){return this.plotGroup("dataLabelsGroup","data-labels",this.hasRendered?"inherit":"hidden",this.options.dataLabels.zIndex||6)}function r(t){var e=this,a=e.hasRendered||0;const i=this.initDataLabelsGroup().attr({opacity:+a});return!a&&i&&(e.visible&&i.show(),e.options.animation?i.animate({opacity:1},t):i.attr({opacity:1})),i}function s(t=this.points){const u=this,L=u.chart,y=u.options,m=L.renderer,{backgroundColor:e,plotBackgroundColor:a}=L.options.chart,x=m.getContrast(isString(a)&&a||isString(e)&&e||"#000000");let i=y.dataLabels,o,v;var r=splat(i)[0],s=r.animation,r=r.defer?getDeferredAnimation(L,s,u):{defer:0,duration:0};i=l(l(L.options.plotOptions&&L.options.plotOptions.series&&L.options.plotOptions.series.dataLabels,L.options.plotOptions&&L.options.plotOptions[u.type]&&L.options.plotOptions[u.type].dataLabels),i),fireEvent(this,"drawDataLabels"),(isArray(i)||i.enabled||u._hasPointLabels)&&(v=this.initDataLabels(r),t.forEach(g=>{(o=splat(l(i,g.dlOptions||g.options&&g.options.dataLabels))).forEach((t,e)=>{var a=t.enabled&&(!g.isNull||g.dataLabelOnNull)&&(i=g,!(f=(f=t).filter)||(a=f.operator,i=i[f.property],f=f.value,">"===a&&f<i||"<"===a&&i<f||">="===a&&f<=i||"<="===a&&i<=f||"=="===a&&i==f||"==="===a&&i===f)),i=g.connectors?g.connectors[e]:g.connector;let o,r,s,n,l,d,c=g.dataLabels?g.dataLabels[e]:g.dataLabel,h=!c;var p,b,f=pick(t.distance,g.labelDistance);a&&(o=g.getLabelConfig(),r=pick(t[g.formatPrefix+"Format"],t.format),s=defined(r)?format(r,o,L):(t[g.formatPrefix+"Formatter"]||t.formatter).call(o,t),n=t.style,l=t.rotation,L.styledMode||(n.color=pick(t.color,n.color,u.color,"#000000"),"contrast"===n.color?(g.contrastColor=m.getContrast(g.color||u.color),n.color=!defined(f)&&t.inside||f<0||y.stacking?g.contrastColor:x):delete g.contrastColor,y.cursor&&(n.cursor=y.cursor)),d={r:t.borderRadius||0,rotation:l,padding:t.padding,zIndex:1},L.styledMode||({backgroundColor:b,borderColor:p}=t,d.fill="auto"===b?g.color:b,d.stroke="auto"===p?g.color:p,d["stroke-width"]=t.borderWidth),objectEach(d,function(t,e){void 0===t&&delete d[e]})),!c||a&&defined(s)&&!!c.div==!!t.useHTML&&(c.rotation&&t.rotation||c.rotation===t.rotation)||(h=!0,g.dataLabel=c=g.dataLabel&&g.dataLabel.destroy(),g.dataLabels&&(1===g.dataLabels.length?delete g.dataLabels:delete g.dataLabels[e]),e||delete g.dataLabel,i&&(g.connector=g.connector.destroy(),g.connectors&&(1===g.connectors.length?delete g.connectors:delete g.connectors[e]))),a&&defined(s)?(c?d.text=s:(g.dataLabels=g.dataLabels||[],c=g.dataLabels[e]=l?m.text(s,0,0,t.useHTML).addClass("highcharts-data-label"):m.label(s,0,0,t.shape,null,null,t.useHTML,null,"data-label"),e||(g.dataLabel=c),c.addClass(" highcharts-data-label-color-"+g.colorIndex+" "+(t.className||"")+(t.useHTML?" highcharts-tracker":""))),c.options=t,c.attr(d),L.styledMode||c.css(n).shadow(t.shadow),(b=t[g.formatPrefix+"TextPath"]||t.textPath)&&!t.useHTML&&(c.setTextPath(g.getDataLabelPath&&g.getDataLabelPath(c)||g.graphic,b),g.dataLabelPath&&!b.enabled&&(g.dataLabelPath=g.dataLabelPath.destroy())),c.added||c.add(v),u.alignDataLabel(g,c,t,null,h)):c&&c.hide()})})),fireEvent(this,"afterDrawDataLabels")}function n(t,e,a,i,o,r){var s=this.chart,n=e.align,l=e.verticalAlign,d=!t.box&&t.padding||0;let{x:c=0,y:h=0}=e,p,b;return(p=(a.x||0)+d)<0&&("right"===n&&0<=c?(e.align="left",e.inside=!0):c-=p,b=!0),(p=(a.x||0)+i.width-d)>s.plotWidth&&("left"===n&&c<=0?(e.align="right",e.inside=!0):c+=s.plotWidth-p,b=!0),(p=a.y+d)<0&&("bottom"===l&&0<=h?(e.verticalAlign="top",e.inside=!0):h-=p,b=!0),(p=(a.y||0)+i.height-d)>s.plotHeight&&("top"===l&&h<=0?(e.verticalAlign="bottom",e.inside=!0):h+=s.plotHeight-p,b=!0),b&&(e.x=c,e.y=h,t.placed=!r,t.align(e,void 0,o)),b}function l(e,a){let t=[],i;if(isArray(e)&&!isArray(a))t=e.map(function(t){return merge(t,a)});else if(isArray(a)&&!isArray(e))t=a.map(function(t){return merge(e,t)});else if(isArray(e)||isArray(a))for(i=Math.max(e.length,a.length);i--;)t[i]=merge(e[i],a[i]);else t=merge(e,a);return t}function d(t,e,a,i,o){var r=this.chart,s=r.inverted,n=this.xAxis,l=n.reversed,d=s?e.height/2:e.width/2,t=t.pointWidth,t=t?t/2:0;e.startXPos=s?o.x:l?-d-t:n.width-d+t,e.startYPos=s?l?this.yAxis.height-d+t:-d-t:o.y,i?"hidden"===e.visibility&&(e.show(),e.attr({opacity:0}).animate({opacity:1})):e.attr({opacity:1}).animate({opacity:0},void 0,e.hide),r.hasRendered&&(a&&e.attr({x:e.startXPos,y:e.startYPos}),e.placed=!0)}t.compose=function(t){if(U.pushUnique(a,t)){const e=t.prototype;e.initDataLabelsGroup=o,e.initDataLabels=r,e.alignDataLabel=i,e.drawDataLabels=s,e.justifyDataLabel=n,e.setDataLabelStartPos=d}}}(DataLabel=DataLabel||{});export default DataLabel;