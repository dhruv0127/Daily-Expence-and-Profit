"use strict";import A from"../Animation/AnimationUtilities.js";const{animObject,setAnimation}=A;import D from"../Defaults.js";const defaultOptions=D["defaultOptions"];import F from"../Foundation.js";const registerEventOptions=F["registerEventOptions"];import H from"../Globals.js";const{hasTouch,svg,win}=H;import LegendSymbol from"../Legend/LegendSymbol.js";import Point from"./Point.js";import SeriesDefaults from"./SeriesDefaults.js";import SeriesRegistry from"./SeriesRegistry.js";const seriesTypes=SeriesRegistry["seriesTypes"];import SVGElement from"../Renderer/SVG/SVGElement.js";import U from"../Utilities.js";const{addEvent,arrayMax,arrayMin,clamp,cleanRecursively,correctFloat,defined,erase,error,extend,find,fireEvent,getNestedProperty,isArray,isNumber,isString,merge,objectEach,pick,removeEvent,splat,syncTimeout}=U;class Series{constructor(){this._i=void 0,this.chart=void 0,this.data=void 0,this.eventOptions=void 0,this.eventsToUnbind=void 0,this.index=void 0,this.linkedSeries=void 0,this.options=void 0,this.points=void 0,this.processedXData=void 0,this.processedYData=void 0,this.tooltipOptions=void 0,this.userOptions=void 0,this.xAxis=void 0,this.yAxis=void 0,this.zones=void 0}init(t,e){fireEvent(this,"init",{options:e});const i=this,s=t.series;this.eventsToUnbind=[],i.chart=t,i.options=i.setOptions(e);var e=i.options,r=(i.linkedSeries=[],i.bindAxes(),extend(i,{name:e.name,state:"",visible:!1!==e.visible,selected:!0===e.selected}),registerEventOptions(this,e),e.events);(r&&r.click||e.point&&e.point.events&&e.point.events.click||e.allowPointSelect)&&(t.runTrackerClick=!0),i.getColor(),i.getSymbol(),i.parallelArrays.forEach(function(t){i[t+"Data"]||(i[t+"Data"]=[])}),i.isCartesian&&(t.hasCartesianSeries=!0);let o;s.length&&(o=s[s.length-1]),i._i=pick(o&&o._i,-1)+1,i.opacity=i.options.opacity,t.orderSeries(this.insert(s)),e.dataSorting&&e.dataSorting.enabled?i.setDataSortingOptions():i.points||i.data||i.setData(e.data,!1),fireEvent(this,"afterInit")}is(t){return seriesTypes[t]&&this instanceof seriesTypes[t]}insert(t){var e=this.options.index;let i;if(isNumber(e)){for(i=t.length;i--;)if(e>=pick(t[i].options.index,t[i]._i)){t.splice(i+1,0,this);break}-1===i&&t.unshift(this),i+=1}else t.push(this);return pick(i,t.length-1)}bindAxes(){const s=this,r=s.options,t=s.chart;let o;fireEvent(this,"bindAxes",null,function(){(s.axisTypes||[]).forEach(function(e){let i=0;t[e].forEach(function(t){o=t.options,(r[e]===i&&!o.isInternal||void 0!==r[e]&&r[e]===o.id||void 0===r[e]&&0===o.index)&&(s.insert(t.series),(s[e]=t).isDirty=!0),o.isInternal||i++}),s[e]||s.optionalAxis===e||error(18,!0,t)})}),fireEvent(this,"afterBindAxes")}updateParallelArrays(i,s,e){const r=i.series,t=isNumber(s)?function(t){var e="y"===t&&r.toYData?r.toYData(i):i[t];r[t+"Data"][s]=e}:function(t){Array.prototype[s].apply(r[t+"Data"],e)};r.parallelArrays.forEach(t)}hasData(){return this.visible&&void 0!==this.dataMax&&void 0!==this.dataMin||this.visible&&this.yData&&0<this.yData.length}autoIncrement(t){const e=this.options,i=e.pointIntervalUnit,s=e.relativeXValue,r=this.chart.time;let o=this.xIncrement,a,n;return o=pick(o,e.pointStart,0),this.pointInterval=n=pick(this.pointInterval,e.pointInterval,1),s&&isNumber(t)&&(n*=t),i&&(a=new r.Date(o),"day"===i?r.set("Date",a,r.get("Date",a)+n):"month"===i?r.set("Month",a,r.get("Month",a)+n):"year"===i&&r.set("FullYear",a,r.get("FullYear",a)+n),n=a.getTime()-o),s&&isNumber(t)?o+n:(this.xIncrement=o+n,o)}setDataSortingOptions(){const t=this.options;extend(this,{requireSorting:!1,sorted:!1,enabledDataSorting:!0,allowDG:!1}),defined(t.pointRange)||(t.pointRange=1)}setOptions(t){var e=this.chart,i=e.options,s=i.plotOptions,r=e.userOptions||{},t=merge(t),e=e.styledMode,o={plotOptions:s,userOptions:t};let a;fireEvent(this,"setOptions",o);var n=o.plotOptions[this.type],l=r.plotOptions||{};this.userOptions=o.userOptions;const h=merge(n,s.series,r.plotOptions&&r.plotOptions[this.type],t),p=(this.tooltipOptions=merge(defaultOptions.tooltip,defaultOptions.plotOptions.series&&defaultOptions.plotOptions.series.tooltip,defaultOptions.plotOptions[this.type].tooltip,i.tooltip.userOptions,s.series&&s.series.tooltip,s[this.type].tooltip,t.tooltip),this.stickyTracking=pick(t.stickyTracking,l[this.type]&&l[this.type].stickyTracking,l.series&&l.series.stickyTracking,!(!this.tooltipOptions.shared||this.noSharedTooltip)||h.stickyTracking),null===n.marker&&delete h.marker,this.zoneAxis=h.zoneAxis,this.zones=(h.zones||[]).slice());return!h.negativeColor&&!h.negativeFillColor||h.zones||(a={value:h[this.zoneAxis+"Threshold"]||h.threshold||0,className:"highcharts-negative"},e||(a.color=h.negativeColor,a.fillColor=h.negativeFillColor),p.push(a)),p.length&&defined(p[p.length-1].value)&&p.push(e?{}:{color:this.color,fillColor:this.fillColor}),fireEvent(this,"afterSetOptions",{options:h}),h}getName(){return pick(this.options.name,"Series "+(this.index+1))}getCyclic(t,e,i){const s=this.chart,r=this.userOptions,o=t+"Index",a=t+"Counter",n=i?i.length:pick(s.options.chart[t+"Count"],s[t+"Count"]);let l,h;e||(h=pick(r[o],r["_"+o]),defined(h)?l=h:(s.series.length||(s[a]=0),r["_"+o]=l=s[a]%n,s[a]+=1),i&&(e=i[l])),void 0!==l&&(this[o]=l),this[t]=e}getColor(){this.chart.styledMode?this.getCyclic("color"):this.options.colorByPoint?this.color="#cccccc":this.getCyclic("color",this.options.color||defaultOptions.plotOptions[this.type].color,this.chart.options.colors)}getPointsCollection(){return(this.hasGroupedData?this.points:this.data)||[]}getSymbol(){var t=this.options.marker;this.getCyclic("symbol",t.symbol,this.chart.options.symbols)}findPointIndex(e,t){var i=e.id,s=e.x,r=this.points,o=this.options.dataSorting;let a,n,l;if(i){i=this.chart.get(i);i instanceof Point&&(a=i)}else if(this.linkedParent||this.enabledDataSorting||this.options.relativeXValue){let t=t=>!t.touched&&t.index===e.index;if(o&&o.matchByName?t=t=>!t.touched&&t.name===e.name:this.options.relativeXValue&&(t=t=>!t.touched&&t.options.x===e.x),!(a=find(r,t)))return}return a&&void 0!==(l=a&&a.index)&&(n=!0),-1!==(l=void 0===l&&isNumber(s)?this.xData.indexOf(s,t):l)&&void 0!==l&&this.cropped&&(l=l>=this.cropStart?l-this.cropStart:l),l=!n&&isNumber(l)&&r[l]&&r[l].touched?void 0:l}updateData(t,e){const r=this.options,o=r.dataSorting,a=this.points,n=[],l=this.requireSorting,h=t.length===a.length;let p,i,s,d,c=!0;if(this.xIncrement=null,t.forEach(function(t,e){var i=defined(t)&&this.pointClass.prototype.optionsToObject.call({series:this},t)||{},s=i.x;i.id||isNumber(s)?(-1===(s=this.findPointIndex(i,d))||void 0===s?n.push(t):a[s]&&t!==r.data[s]?(a[s].update(t,!1,null,!1),a[s].touched=!0,l&&(d=s+1)):a[s]&&(a[s].touched=!0),(!h||e!==s||o&&o.enabled||this.hasDerivedData)&&(p=!0)):n.push(t)},this),p)for(i=a.length;i--;)(s=a[i])&&!s.touched&&s.remove&&s.remove(!1,e);else!h||o&&o.enabled?c=!1:(t.forEach(function(t,e){t===a[e].y||a[e].destroyed||a[e].update(t,!1,null,!1)}),n.length=0);return a.forEach(function(t){t&&(t.touched=!1)}),!!c&&(n.forEach(function(t){this.addPoint(t,!1,null,null,!1)},this),null===this.xIncrement&&this.xData&&this.xData.length&&(this.xIncrement=arrayMax(this.xData),this.autoIncrement()),!0)}setData(t,e=!0,i,s){var r;const o=this,a=o.points,n=a&&a.length||0,l=o.options,h=o.chart,p=l.dataSorting,d=o.xAxis,c=l.turboThreshold,u=this.xData,g=this.yData,m=o.pointArrayMap,f=m&&m.length,y=l.keys;let v,x,k,b=0,D=1,S,A;h.options.chart.allowMutatingData||(l.data&&delete o.options.data,o.userOptions.data&&delete o.userOptions.data,A=merge(!0,t));var O=(t=A||t||[]).length;if(p&&p.enabled&&(t=this.sortData(t)),!(k=h.options.chart.allowMutatingData&&!1!==s&&O&&n&&!o.cropped&&!o.hasGroupedData&&o.visible&&!o.boosted?this.updateData(t,i):k)){if(o.xIncrement=null,o.colorCounter=0,this.parallelArrays.forEach(function(t){o[t+"Data"].length=0}),c&&c<O)if(S=o.getFirstValidPoint(t),isNumber(S))for(v=0;v<O;v++)u[v]=this.autoIncrement(),g[v]=t[v];else if(isArray(S))if(f)if(S.length===f)for(v=0;v<O;v++)u[v]=this.autoIncrement(),g[v]=t[v];else for(v=0;v<O;v++)x=t[v],u[v]=x[0],g[v]=x.slice(1,f+1);else if(y&&(b=y.indexOf("x"),D=y.indexOf("y"),b=0<=b?b:0,D=0<=D?D:1),1===S.length&&(D=0),b===D)for(v=0;v<O;v++)u[v]=this.autoIncrement(),g[v]=t[v][D];else for(v=0;v<O;v++)x=t[v],u[v]=x[b],g[v]=x[D];else error(12,!1,h);else for(v=0;v<O;v++)x={series:o},o.pointClass.prototype.applyOptions.apply(x,[t[v]]),o.updateParallelArrays(x,v);for(g&&isString(g[0])&&error(14,!0,h),o.data=[],o.options.data=o.userOptions.data=t,v=n;v--;)null!=(r=a[v])&&r.destroy();d&&(d.minRange=d.userMinRange),o.isDirty=h.isDirtyBox=!0,o.isDirtyData=!!a,i=!1}"point"===l.legendType&&(this.processData(),this.generatePoints()),e&&h.redraw(i)}sortData(r){function o(t,e){return defined(e)&&t.pointClass.prototype.optionsToObject.call({series:t},e)||{}}const i=this,t=i.options,e=t.dataSorting,s=e.sortKey||"y",a=(r.forEach(function(t,e){r[e]=o(i,t),r[e].index=e},this),r.concat().sort((t,e)=>{t=getNestedProperty(s,t),e=getNestedProperty(s,e);return e<t?-1:t<e?1:0}));return a.forEach(function(t,e){t.x=e},this),i.linkedSeries&&i.linkedSeries.forEach(function(i){const t=i.options,s=t.data;t.dataSorting&&t.dataSorting.enabled||!s||(s.forEach(function(t,e){s[e]=o(i,t),r[e]&&(s[e].x=r[e].x,s[e].index=e)}),i.setData(s,!1))}),r}getProcessedData(t){const e=this,i=e.xAxis,s=e.options,r=s.cropThreshold,o=t||e.getExtremesFromAll||s.getExtremesFromAll,a=e.isCartesian,n=i&&i.val2lin,l=!(!i||!i.logarithmic);let h,p,d=0,c,u,g,m,f,y,v=e.xData,x=e.yData,k=e.requireSorting,b=!1;t=v.length;for(i&&(m=i.getExtremes(),f=m.min,y=m.max,b=!(!i.categories||i.names.length)),a&&e.sorted&&!o&&(!r||r<t||e.forceCrop)&&(v[t-1]<f||v[0]>y?(v=[],x=[]):e.yData&&(v[0]<f||v[t-1]>y)&&(h=this.cropData(e.xData,e.yData,f,y),v=h.xData,x=h.yData,d=h.start,p=!0)),g=v.length||1;--g;)0<(c=l?n(v[g])-n(v[g-1]):v[g]-v[g-1])&&(void 0===u||c<u)?u=c:c<0&&k&&!b&&(error(15,!1,e.chart),k=!1);return{xData:v,yData:x,cropped:p,cropStart:d,closestPointRange:u}}processData(t){var e=this,i=e.xAxis;if(e.isCartesian&&!e.isDirty&&!i.isDirty&&!e.yAxis.isDirty&&!t)return!1;i=e.getProcessedData();e.cropped=i.cropped,e.cropStart=i.cropStart,e.processedXData=i.xData,e.processedYData=i.yData,e.closestPointRange=e.basePointRange=i.closestPointRange,fireEvent(e,"afterProcessData")}cropData(t,e,i,s,r){var o=t.length;let a,n,l=0,h=o;for(r=pick(r,this.cropShoulder),a=0;a<o;a++)if(t[a]>=i){l=Math.max(0,a-r);break}for(n=a;n<o;n++)if(t[n]>s){h=n+r;break}return{xData:t.slice(l,h),yData:e.slice(l,h),start:l,end:h}}generatePoints(){const t=this,e=t.options,i=t.processedData||e.data,s=t.processedXData,r=t.processedYData,o=t.pointClass,a=s.length,n=t.cropStart||0,l=t.hasGroupedData,h=e.keys,p=[],d=e.dataGrouping&&e.dataGrouping.groupAll?n:0;let c,u,g,m,f=t.data;if(!f&&!l){const y=[];y.length=i.length,f=t.data=y}for(h&&l&&(t.options.keys=!1),m=0;m<a;m++)u=n+m,l?((g=(new o).init(t,[s[m]].concat(splat(r[m])))).dataGroup=t.groupMap[d+m],g.dataGroup.options&&(g.options=g.dataGroup.options,extend(g,g.dataGroup.options),delete g.dataLabels)):(g=f[u])||void 0===i[u]||(f[u]=g=(new o).init(t,i[u],s[m])),g&&(g.index=l?d+m:u,p[m]=g);if(t.options.keys=h,f&&(a!==(c=f.length)||l))for(m=0;m<c;m++)m!==n||l||(m+=a),f[m]&&(f[m].destroyElements(),f[m].plotX=void 0);t.data=f,t.points=p,fireEvent(this,"afterGeneratePoints")}getXExtremes(t){return{min:arrayMin(t),max:arrayMax(t)}}getExtremes(t,e){const i=this.xAxis,s=this.yAxis,r=this.processedXData||this.xData,o=[],a=this.requireSorting?this.cropShoulder:0,n=!!s&&s.positiveValuesOnly;let l,h,p,d,c,u,g,m=0,f=0,y=0;var v=(t=t||this.stackedYData||this.processedYData||[]).length;for(i&&(l=i.getExtremes(),m=l.min,f=l.max),u=0;u<v;u++)if(d=r[u],c=t[u],h=(isNumber(c)||isArray(c))&&(c.length||0<c||!n),p=e||this.getExtremesFromAll||this.options.getExtremesFromAll||this.cropped||!i||(r[u+a]||d)>=m&&(r[u-a]||d)<=f,h&&p)if(g=c.length)for(;g--;)isNumber(c[g])&&(o[y++]=c[g]);else o[y++]=c;var x={activeYData:o,dataMin:arrayMin(o),dataMax:arrayMax(o)};return fireEvent(this,"afterGetExtremes",{dataExtremes:x}),x}applyExtremes(){var t=this.getExtremes();return this.dataMin=t.dataMin,this.dataMax=t.dataMax,t}getFirstValidPoint(t){var e=t.length;let i=0,s=null;for(;null===s&&i<e;)s=t[i],i++;return s}translate(){this.processedXData||this.processData(),this.generatePoints();const o=this,a=o.options,n=a.stacking,l=o.xAxis,h=l.categories,p=o.enabledDataSorting,d=o.yAxis,c=o.points,t=c.length,u=o.pointPlacementToXValue(),g=Boolean(u),m=a.threshold,f=a.startFromThreshold?m:0,y=this.zoneAxis||"y";let v,x,k,b,D=Number.MAX_VALUE;function S(t){return clamp(t,-1e5,1e5)}for(v=0;v<t;v++){const O=c[v],E=O.x;let t,e,i=O.y,s=O.low;var A=n&&(null==(A=d.stacking)?void 0:A.stacks[(o.negStacks&&i<(f?0:m)?"-":"")+o.stackKey]);x=l.translate(E,!1,!1,!1,!0,u),O.plotX=isNumber(x)?correctFloat(S(x)):void 0,n&&o.visible&&A&&A[E]&&(b=o.getStackIndicator(b,E,o.index),!O.isNull&&b.key&&(t=A[E],e=t.points[b.key]),t&&isArray(e)&&(s=e[0],i=e[1],s===f&&b.key===A[E].base&&(s=pick(isNumber(m)?m:d.min)),d.positiveValuesOnly&&defined(s)&&s<=0&&(s=void 0),O.total=O.stackTotal=pick(t.total),O.percentage=defined(O.y)&&t.total?O.y/t.total*100:void 0,O.stackY=i,o.irregularWidths||t.setOffset(o.pointXOffset||0,o.barW||0,void 0,void 0,void 0,o.xAxis))),O.yBottom=defined(s)?S(d.translate(s,!1,!0,!1,!0)):void 0,o.dataModify&&(i=o.dataModify.modifyValue(i,v));let r;isNumber(i)&&void 0!==O.plotX&&(r=d.translate(i,!1,!0,!1,!0),r=isNumber(r)?S(r):void 0),O.plotY=r,O.isInside=this.isPointInside(O),O.clientX=g?correctFloat(l.translate(E,!1,!1,!1,!0,u)):x,O.negative=O[y]<(a[y+"Threshold"]||m||0),O.category=pick(h&&h[O.x],O.x),O.isNull||!1===O.visible||(void 0!==k&&(D=Math.min(D,Math.abs(x-k))),k=x),O.zone=this.zones.length?O.getZone():void 0,!O.graphic&&o.group&&p&&(O.isNew=!0)}o.closestPointRangePx=D,fireEvent(this,"afterTranslate")}getValidPoints(t,s,r){const o=this.chart;return(t||this.points||[]).filter(function(t){var{plotX:e,plotY:i}=t;return!(!(r||!t.isNull&&isNumber(i))||s&&!o.isInsidePlot(e,i,{inverted:o.inverted}))&&!1!==t.visible})}getClipBox(){var{chart:t,xAxis:e,yAxis:i}=this;const s=merge(t.clipBox);return e&&e.len!==t.plotSizeX&&(s.width=e.len),i&&i.len!==t.plotSizeY&&(s.height=i.len),s}getSharedClipKey(){return this.sharedClipKey=(this.options.xAxis||0)+","+(this.options.yAxis||0),this.sharedClipKey}setClip(){const{chart:t,group:e,markerGroup:i}=this,s=t.sharedClips,r=t.renderer,o=this.getClipBox(),a=this.getSharedClipKey();let n=s[a];n?n.animate(o):s[a]=n=r.clipRect(o),e&&e.clip(!1===this.options.clip?void 0:n),i&&i.clip()}animate(t){const{chart:e,group:i,markerGroup:s}=this,r=e.inverted,o=animObject(this.options.animation),a=[this.getSharedClipKey(),o.duration,o.easing,o.defer].join(",");let n=e.sharedClips[a],l=e.sharedClips[a+"m"];if(t&&i){const h=this.getClipBox();n?n.attr("height",h.height):(h.width=0,r&&(h.x=e.plotHeight),n=e.renderer.clipRect(h),e.sharedClips[a]=n,t={x:(r,-99),y:(r,-99),width:r?e.plotWidth+199:99,height:r?99:e.plotHeight+199},l=e.renderer.clipRect(t),e.sharedClips[a+"m"]=l),i.clip(n),s&&s.clip(l)}else if(n&&!n.hasClass("highcharts-animating")){const p=this.getClipBox(),d=o.step;s&&s.element.childNodes.length&&(o.step=function(t,e){d&&d.apply(e,arguments),"width"===e.prop&&l&&l.element&&l.attr(r?"height":"width",t+99)}),n.addClass("highcharts-animating").animate(p,o)}}afterAnimate(){this.setClip(),objectEach(this.chart.sharedClips,(t,e,i)=>{t&&!this.chart.container.querySelector(`[clip-path="url(#${t.id})"]`)&&(t.destroy(),delete i[e])}),this.finishedAnimating=!0,fireEvent(this,"afterAnimate")}drawPoints(t=this.points){const e=this,i=e.chart,s=i.styledMode,{colorAxis:r,options:o}=e,a=o.marker,n=e[e.specialGroup||"markerGroup"],l=e.xAxis,h=pick(a.enabled,!(l&&!l.isRadial)||null,e.closestPointRangePx>=a.enabledThreshold*a.radius);let p,d,c,u,g,m,f;if(!1!==a.enabled||e._hasPointMarkers)for(p=0;p<t.length;p++){var y,v;d=t[p],c=d.graphic,u=c?"animate":"attr",g=d.marker||{},m=!!d.marker,(h&&void 0===g.enabled||g.enabled)&&!d.isNull&&!1!==d.visible?(v=pick(g.symbol,e.symbol,"rect"),f=e.markerAttribs(d,d.selected&&"select"),e.enabledDataSorting&&(d.startXPos=l.reversed?-(f.width||0):l.width),y=!1!==d.isInside,!c&&y&&(0<(f.width||0)||d.hasImage)&&(d.graphic=c=i.renderer.symbol(v,f.x,f.y,f.width,f.height,m?g:a).add(n),e.enabledDataSorting&&i.hasRendered&&(c.attr({x:d.startXPos}),u="animate")),c&&"animate"===u&&c[y?"show":"hide"](y).animate(f),c&&(v=e.pointAttribs(d,s||!d.selected?void 0:"select"),s?r&&c.css({fill:v.fill}):c[u](v)),c&&c.addClass(d.getClassName(),!0)):c&&(d.graphic=c.destroy())}}markerAttribs(t,e){const i=this.options,s=i.marker,r=t.marker||{},o=r.symbol||s.symbol,a={};let n,l,h=pick(r.radius,s&&s.radius);e&&(n=s.states[e],l=r.states&&r.states[e],h=pick(l&&l.radius,n&&n.radius,h&&h+(n&&n.radiusPlus||0))),t.hasImage=o&&0===o.indexOf("url"),t.hasImage&&(h=0);e=t.pos();return isNumber(h)&&e&&(a.x=e[0]-h,a.y=e[1]-h,i.crisp&&(a.x=Math.floor(a.x))),h&&(a.width=a.height=2*h),a}pointAttribs(t,e){var i=this.options.marker,s=t&&t.options,r=s&&s.marker||{},s=s&&s.color,o=t&&t.color,t=t&&t.zone&&t.zone.color;let a,n,l=this.color,h,p,d=pick(r.lineWidth,i.lineWidth),c=1;return l=s||t||o||l,h=r.fillColor||i.fillColor||l,p=r.lineColor||i.lineColor||l,(e=e||"normal")&&(a=i.states[e]||{},n=r.states&&r.states[e]||{},d=pick(n.lineWidth,a.lineWidth,d+pick(n.lineWidthPlus,a.lineWidthPlus,0)),h=n.fillColor||a.fillColor||h,p=n.lineColor||a.lineColor||p,c=pick(n.opacity,a.opacity,c)),{stroke:p,"stroke-width":d,fill:h,opacity:c}}destroy(i){const s=this,t=s.chart,r=/AppleWebKit\/533/.test(win.navigator.userAgent),e=s.data||[];let o,a,n,l;for(fireEvent(s,"destroy",{keepEventsForUpdate:i}),this.removeEvents(i),(s.axisTypes||[]).forEach(function(t){(l=s[t])&&l.series&&(erase(l.series,s),l.isDirty=l.forceRedraw=!0)}),s.legendItem&&s.chart.legend.destroyItem(s),a=e.length;a--;)(n=e[a])&&n.destroy&&n.destroy();s.clips&&s.clips.forEach(t=>t.destroy()),U.clearTimeout(s.animationTimeout),objectEach(s,function(t,e){t instanceof SVGElement&&!t.survive&&t[o=r&&"group"===e?"hide":"destroy"]()}),t.hoverSeries===s&&(t.hoverSeries=void 0),erase(t.series,s),t.orderSeries(),objectEach(s,function(t,e){i&&"hcEvents"===e||delete s[e]})}applyZones(){const i=this,s=this.chart,r=s.renderer,t=this.zones,o=this.clips||[],a=this.graph,n=this.area,l=Math.max(s.plotWidth,s.plotHeight),h=this[(this.zoneAxis||"y")+"Axis"],p=s.inverted;let d,c,u,g,m,f,y,v,x,k,b,D=!1;t.length&&(a||n)&&h&&void 0!==h.min?(m=h.reversed,f=h.horiz,a&&!this.showLine&&a.hide(),n&&n.hide(),g=h.getExtremes(),t.forEach(function(t,e){d=m?f?s.plotWidth:0:!f&&h.toPixels(g.min)||0,d=clamp(pick(c,d),0,l),c=clamp(Math.round(h.toPixels(pick(t.value,g.max),!0)||0),0,l),D&&(d=c=h.toPixels(g.max)),y=Math.abs(d-c),v=Math.min(d,c),x=Math.max(d,c),h.isXAxis?(u={x:p?x:v,y:0,width:y,height:l},f||(u.x=s.plotHeight-u.x)):(u={x:0,y:p?x:v,width:l,height:y},f&&(u.y=s.plotWidth-u.y)),o[e]?o[e].animate(u):o[e]=r.clipRect(u),k=i["zone-area-"+e],b=i["zone-graph-"+e],a&&b&&b.clip(o[e]),n&&k&&k.clip(o[e]),D=t.value>g.max,i.resetZones&&0===c&&(c=void 0)}),this.clips=o):i.visible&&(a&&a.show(),n&&n.show())}plotGroup(t,e,i,s,r){let o=this[t];const a=!o,n={visibility:i,zIndex:s||.1};return void 0===this.opacity||this.chart.styledMode||"inactive"===this.state||(n.opacity=this.opacity),a&&(this[t]=o=this.chart.renderer.g().add(r)),o.addClass("highcharts-"+e+" highcharts-series-"+this.index+" highcharts-"+this.type+"-series "+(defined(this.colorIndex)?"highcharts-color-"+this.colorIndex+" ":"")+(this.options.className||"")+(o.hasClass("highcharts-tracker")?" highcharts-tracker":""),!0),o.attr(n)[a?"attr":"animate"](this.getPlotBox(e)),o}getPlotBox(t){let e=this.xAxis,i=this.yAxis;var s=this.chart,t=s.inverted&&!s.polar&&e&&!1!==this.invertible&&"series"===t;return s.inverted&&(e=i,i=this.xAxis),{translateX:e?e.left:s.plotLeft,translateY:i?i.top:s.plotTop,rotation:t?90:0,rotationOriginX:t?(e.len-i.len)/2:0,rotationOriginY:t?(e.len+i.len)/2:0,scaleX:t?-1:1,scaleY:1}}removeEvents(t){t||removeEvent(this),this.eventsToUnbind.length&&(this.eventsToUnbind.forEach(function(t){t()}),this.eventsToUnbind.length=0)}render(){const t=this,e=t.chart,i=t.options,s=animObject(i.animation),r=t.visible?"inherit":"hidden",o=i.zIndex,a=t.hasRendered,n=e.seriesGroup;e.inverted;let l=t.finishedAnimating?0:s.duration;fireEvent(this,"render");t.plotGroup("group","series",r,o,n);t.markerGroup=t.plotGroup("markerGroup","markers",r,o,n),!1!==i.clip&&t.setClip(),t.animate&&l&&t.animate(!0),t.drawGraph&&(t.drawGraph(),t.applyZones()),t.visible&&t.drawPoints(),t.drawDataLabels&&t.drawDataLabels(),t.redrawPoints&&t.redrawPoints(),t.drawTracker&&!1!==t.options.enableMouseTracking&&t.drawTracker(),t.animate&&l&&t.animate(),a||(l&&s.defer&&(l+=s.defer),t.animationTimeout=syncTimeout(function(){t.afterAnimate()},l||0)),t.isDirty=!1,t.hasRendered=!0,fireEvent(t,"afterRender")}redraw(){var t=this.isDirty||this.isDirtyData;this.translate(),this.render(),t&&delete this.kdTree}searchPoint(t,e){var i=this.xAxis,s=this.yAxis,r=this.chart.inverted;return this.searchKDTree({clientX:r?i.len-t.chartY+i.pos:t.chartX-i.pos,plotY:r?s.len-t.chartX+s.pos:t.chartY-s.pos},e,t)}buildKDTree(t){this.buildingKdTree=!0;const n=this,e=-1<n.options.findNearestPointBy.indexOf("y")?2:1;delete n.kdTree,syncTimeout(function(){n.kdTree=function t(e,i,s){var r=e&&e.length;let o,a;if(r)return o=n.kdAxisArray[i%s],e.sort(function(t,e){return t[o]-e[o]}),{point:e[a=Math.floor(r/2)],left:t(e.slice(0,a),i+1,s),right:t(e.slice(a+1),i+1,s)}}(n.getValidPoints(null,!n.directTouch),e,e),n.buildingKdTree=!1},n.options.kdNow||t&&"touchstart"===t.type?0:1)}searchKDTree(t,e,i){const c=this,u=this.kdAxisArray[0],g=this.kdAxisArray[1],m=e?"distX":"dist",s=-1<c.options.findNearestPointBy.indexOf("y")?2:1;function f(t,e,i,s){var r=e.point,o=c.kdAxisArray[i%s];let a,n,l=r;h=t,p=r,d=defined(h[u])&&defined(p[u])?Math.pow(h[u]-p[u],2):null,h=(d||0)+((defined(h[g])&&defined(p[g])?Math.pow(h[g]-p[g],2):null)||0),p.dist=defined(h)?Math.sqrt(h):Number.MAX_VALUE,p.distX=defined(d)?Math.sqrt(d):Number.MAX_VALUE;var h=t[o]-r[o],p=h<0?"left":"right",d=h<0?"right":"left";return e[p]&&(a=f(t,e[p],i+1,s),l=a[m]<l[m]?a:r),e[d]&&Math.sqrt(h*h)<l[m]&&(n=f(t,e[d],i+1,s),l=n[m]<l[m]?n:l),l}if(this.kdTree||this.buildingKdTree||this.buildKDTree(i),this.kdTree)return f(t,this.kdTree,s,s)}pointPlacementToXValue(){var{options:{pointPlacement:t,pointRange:e},xAxis:i}=this;let s=t;return"between"===s&&(s=i.reversed?-.5:.5),isNumber(s)?s*(e||i.pointRange):0}isPointInside(t){var{chart:e,xAxis:i,yAxis:s}=this;return void 0!==t.plotY&&void 0!==t.plotX&&0<=t.plotY&&t.plotY<=(s?s.len:e.plotHeight)&&0<=t.plotX&&t.plotX<=(i?i.len:e.plotWidth)}drawTracker(){function e(t){o.hoverSeries!==i&&i.onMouseOver()}const i=this,s=i.options,t=s.trackByArea,r=[].concat(t?i.areaPath:i.graphPath),o=i.chart,a=o.pointer,n=o.renderer,l=o.options.tooltip.snap,h=i.tracker,p="rgba(192,192,192,"+(svg?1e-4:.002)+")";h?h.attr({d:r}):i.graph&&(i.tracker=n.path(r).attr({visibility:i.visible?"inherit":"hidden",zIndex:2}).addClass(t?"highcharts-tracker-area":"highcharts-tracker-line").add(i.group),o.styledMode||i.tracker.attr({"stroke-linecap":"round","stroke-linejoin":"round",stroke:p,fill:t?p:"none","stroke-width":i.graph.strokeWidth()+(t?0:2*l)}),[i.tracker,i.markerGroup,i.dataLabelsGroup].forEach(function(t){t&&(t.addClass("highcharts-tracker").on("mouseover",e).on("mouseout",function(t){a.onTrackerMouseOut(t)}),s.cursor&&!o.styledMode&&t.css({cursor:s.cursor}),hasTouch&&t.on("touchstart",e))})),fireEvent(this,"afterDrawTracker")}addPoint(t,e,i,s,r){const o=this,a=o.options,n=o.data,l=o.chart,h=o.xAxis,p=h&&h.hasNames&&h.names,d=a.data,c=o.xData;let u,g;e=pick(e,!0);var m={series:o},f=(o.pointClass.prototype.applyOptions.apply(m,[t]),m.x);if(g=c.length,o.requireSorting&&f<c[g-1])for(u=!0;g&&c[g-1]>f;)g--;o.updateParallelArrays(m,"splice",[g,0,0]),o.updateParallelArrays(m,g),p&&m.name&&(p[f]=m.name),d.splice(g,0,t),(u||o.processedData)&&(o.data.splice(g,0,null),o.processData()),"point"===a.legendType&&o.generatePoints(),i&&(n[0]&&n[0].remove?n[0].remove(!1):(n.shift(),o.updateParallelArrays(m,"shift"),d.shift())),!1!==r&&fireEvent(o,"addPoint",{point:m}),o.isDirty=!0,o.isDirtyData=!0,e&&l.redraw(s)}removePoint(t,e,i){function s(){n&&n.length===o.length&&n.splice(t,1),o.splice(t,1),r.options.data.splice(t,1),r.updateParallelArrays(a||{series:r},"splice",[t,1]),a&&a.destroy(),r.isDirty=!0,r.isDirtyData=!0,e&&l.redraw()}const r=this,o=r.data,a=o[t],n=r.points,l=r.chart;setAnimation(i,l),e=pick(e,!0),a?a.firePointEvent("remove",null,s):s()}remove(t,e,i,s){const r=this,o=r.chart;function a(){r.destroy(s),o.isDirtyLegend=o.isDirtyBox=!0,o.linkSeries(s),pick(t,!0)&&o.redraw(e)}!1!==i?fireEvent(r,"remove",null,a):a()}update(t,e){t=cleanRecursively(t,this.userOptions),fireEvent(this,"update",{options:t});const i=this,s=i.chart,r=i.userOptions,o=i.initialType||i.type,a=s.options.plotOptions,n=seriesTypes[o].prototype,l=i.finishedAnimating&&{animation:!1},h={};let p,d,c=["eventOptions","navigatorSeries","baseSeries"],u=t.type||r.type||s.options.chart.type;var g,m=!(this.hasDerivedData||u&&u!==this.type||void 0!==t.pointStart||void 0!==t.pointInterval||void 0!==t.relativeXValue||t.joinBy||t.mapData||i.hasOptionChanged("dataGrouping")||i.hasOptionChanged("pointStart")||i.hasOptionChanged("pointInterval")||i.hasOptionChanged("pointIntervalUnit")||i.hasOptionChanged("keys"));u=u||o,m&&(c.push("data","isDirtyData","points","processedData","processedXData","processedYData","xIncrement","cropped","_hasPointMarkers","_hasPointLabels","clips","nodes","layout","level","mapMap","mapData","minY","maxY","minX","maxX"),!1!==t.visible&&c.push("area","graph"),i.parallelArrays.forEach(function(t){c.push(t+"Data")}),t.data&&(t.dataSorting&&extend(i.options.dataSorting,t.dataSorting),this.setData(t.data,!1))),t=merge(r,l,{index:(void 0===r.index?i:r).index,pointStart:pick(a&&a.series&&a.series.pointStart,r.pointStart,i.xData[0])},!m&&{data:i.options.data},t),m&&t.data&&(t.data=i.options.data),(c=["group","markerGroup","dataLabelsGroup","transformGroup"].concat(c)).forEach(function(t){c[t]=i[t],delete i[t]});let f=!1;if(seriesTypes[u]){if(f=u!==i.type,i.remove(!1,!1,!1,!0),f)if(Object.setPrototypeOf)Object.setPrototypeOf(i,seriesTypes[u].prototype);else{var y=Object.hasOwnProperty.call(i,"hcEvents")&&i.hcEvents;for(d in n)i[d]=void 0;extend(i,seriesTypes[u].prototype),y?i.hcEvents=y:delete i.hcEvents}}else error(17,!0,s,{missingModuleFor:u});if(c.forEach(function(t){i[t]=c[t]}),i.init(s,t),m&&this.points){!1===(p=i.options).visible?(h.graphic=1,h.dataLabel=1):i._hasPointLabels||({marker:y,dataLabels:t}=p,g=r.marker||{},!y||!1!==y.enabled&&g.symbol===y.symbol&&g.height===y.height&&g.width===y.width||(h.graphic=1),t&&!1===t.enabled&&(h.dataLabel=1));for(const v of this.points)v&&v.series&&(v.resolveColor(),Object.keys(h).length&&v.destroyElements(h),!1===p.showInLegend&&v.legendItem&&s.legend.destroyItem(v))}i.initialType=o,s.linkSeries(),f&&i.linkedSeries.length&&(i.isDirtyData=!0),fireEvent(this,"afterUpdate"),pick(e,!0)&&s.redraw(m&&void 0)}setName(t){this.name=this.options.name=this.userOptions.name=t,this.chart.isDirtyLegend=!0}hasOptionChanged(t){var e=this.chart,i=this.options[t],e=e.options.plotOptions,s=this.userOptions[t];return s?i!==s:i!==pick(e&&e[this.type]&&e[this.type][t],e&&e.series&&e.series[t],i)}onMouseOver(){const t=this,e=t.chart,i=e.hoverSeries,s=e.pointer;s.setHoverChartIndex(),i&&i!==t&&i.onMouseOut(),t.options.events.mouseOver&&fireEvent(t,"mouseOver"),t.setState("hover"),e.hoverSeries=t}onMouseOut(){const t=this,e=t.options,i=t.chart,s=i.tooltip,r=i.hoverPoint;i.hoverSeries=null,r&&r.onMouseOut(),t&&e.events.mouseOut&&fireEvent(t,"mouseOut"),!s||t.stickyTracking||s.shared&&!t.noSharedTooltip||s.hide(),i.series.forEach(function(t){t.setState("",!0)})}setState(e,t){const i=this,s=i.options,r=i.graph,o=s.inactiveOtherPoints,a=s.states,n=pick(a[e||"normal"]&&a[e||"normal"].animation,i.chart.options.chart.animation);let l,h=s.lineWidth,p=0,d=s.opacity;if(e=e||"",i.state!==e&&([i.group,i.markerGroup,i.dataLabelsGroup].forEach(function(t){t&&(i.state&&t.removeClass("highcharts-series-"+i.state),e&&t.addClass("highcharts-series-"+e))}),i.state=e,!i.chart.styledMode)){if(a[e]&&!1===a[e].enabled)return;if(e&&(h=a[e].lineWidth||h+(a[e].lineWidthPlus||0),d=pick(a[e].opacity,d)),r&&!r.dashstyle&&isNumber(h))for(l={"stroke-width":h},r.animate(l,n);i["zone-graph-"+p];)i["zone-graph-"+p].animate(l,n),p+=1;o||[i.group,i.markerGroup,i.dataLabelsGroup,i.labelBySeries].forEach(function(t){t&&t.animate({opacity:d},n)})}t&&o&&i.points&&i.setAllPointsToState(e||void 0)}setAllPointsToState(e){this.points.forEach(function(t){t.setState&&t.setState(e)})}setVisible(e,t){const i=this,s=i.chart,r=s.options.chart.ignoreHiddenSeries,o=i.visible,a=(i.visible=e=i.options.visible=i.userOptions.visible=void 0===e?!o:e,e?"show":"hide");["group","dataLabelsGroup","markerGroup","tracker","tt"].forEach(function(t){i[t]&&i[t][a]()}),s.hoverSeries!==i&&(s.hoverPoint&&s.hoverPoint.series)!==i||i.onMouseOut(),i.legendItem&&s.legend.colorizeItem(i,e),i.isDirty=!0,i.options.stacking&&s.series.forEach(function(t){t.options.stacking&&t.visible&&(t.isDirty=!0)}),i.linkedSeries.forEach(function(t){t.setVisible(e,!1)}),r&&(s.isDirtyBox=!0),fireEvent(i,a),!1!==t&&s.redraw()}show(){this.setVisible(!0)}hide(){this.setVisible(!1)}select(t){var e=this;e.selected=t=this.options.selected=void 0===t?!e.selected:t,e.checkbox&&(e.checkbox.checked=t),fireEvent(e,t?"select":"unselect")}shouldShowTooltip(t,e,i={}){return i.series=this,i.visiblePlotOnly=!0,this.chart.isInsidePlot(t,e,i)}drawLegendSymbol(t,e){var i;null!=(i=LegendSymbol[this.options.legendSymbol||"rectangle"])&&i.call(this,t,e)}}Series.defaultOptions=SeriesDefaults,Series.types=SeriesRegistry.seriesTypes,Series.registerType=SeriesRegistry.registerSeriesType,extend(Series.prototype,{axisTypes:["xAxis","yAxis"],coll:"series",colorCounter:0,cropShoulder:1,directTouch:!1,isCartesian:!0,kdAxisArray:["clientX","plotY"],parallelArrays:["x","y"],pointClass:Point,requireSorting:!0,sorted:!0});export default SeriesRegistry.series=Series;