"use strict";import AST from"./AST.js";import SVGElement from"../SVG/SVGElement.js";import SVGRenderer from"../SVG/SVGRenderer.js";import U from"../../Utilities.js";const{attr,createElement,extend,pick}=U,composedMembers=[];class HTMLRenderer extends SVGRenderer{static compose(t){if(U.pushUnique(composedMembers,t)){const e=HTMLRenderer.prototype,s=t.prototype;s.html=e.html}return t}html(t,e,s){function d(o,i){["opacity","visibility"].forEach(function(n){o[n+"Setter"]=function(t,e,s){const r=o.div?o.div.style:i;SVGElement.prototype[n+"Setter"].call(this,t,e,s),r&&(r[e]=t)}}),o.addedSetters=!0}const c=this.createElement("span"),r=c.element,n=c.renderer;return c.textSetter=function(t){t!==this.textStr&&(delete this.bBox,delete this.oldTextWidth,AST.setElementHTML(this.element,pick(t,"")),this.textStr=t,c.doTransform=!0)},d(c,c.element.style),c.xSetter=c.ySetter=c.alignSetter=c.rotationSetter=function(t,e){"align"===e?c.alignValue=c.textAlign=t:c[e]=t,c.doTransform=!0},c.afterSetters=function(){this.doTransform&&(this.htmlUpdateTransform(),this.doTransform=!1)},c.attr({text:t,x:Math.round(e),y:Math.round(s)}).css({position:"absolute"}),n.styledMode||c.css({fontFamily:this.style.fontFamily,fontSize:this.style.fontSize}),r.style.whiteSpace="nowrap",c.css=c.htmlCss,c.add=function(t){const i=n.box.parentNode,a=[];let l,e;if(this.parentGroup=t){if(!(l=t.div)){for(e=t;e;)a.push(e),e=e.parentGroup;a.reverse().forEach(function(s){var t=attr(s.element,"class");function e(t,e){s[e]=t,"translateX"===e?o.left=t+"px":o.top=t+"px",s.doTransform=!0}var r,n=s.styles||{};const o=(l=s.div=s.div||createElement("div",t?{className:t}:void 0,{position:"absolute",left:(s.translateX||0)+"px",top:(s.translateY||0)+"px",display:s.display,opacity:s.opacity,visibility:s.visibility},l||i)).style;extend(s,{classSetter:(r=l,function(t){this.element.setAttribute("class",t),r.className=t}),css:function(e){return c.css.call(s,e),["cursor","pointerEvents"].forEach(t=>{e[t]&&(o[t]=e[t])}),s},on:function(){return a[0].div&&c.on.apply({element:a[0].div,onEvents:s.onEvents},arguments),s},translateXSetter:e,translateYSetter:e}),s.addedSetters||d(s),s.css(n)})}}else l=i;return l.appendChild(r),c.added=!0,c.alignOnAdd&&c.htmlUpdateTransform(),c},c}}export default HTMLRenderer;