"use strict";import U from"../Utilities.js";const{clamp,pick,stableSort}=U;var RendererUtilities;(RendererUtilities||(RendererUtilities={})).distribute=function s(e,r,i){const a=e,t=a.reducedLen||r,l=(e,t)=>e.target-t.target;let o,n=!0,p=[],g,c,d=0;for(o=e.length;o--;)d+=e[o].size;if(d>t){for(stableSort(e,(e,t)=>(t.rank||0)-(e.rank||0)),o=0,d=0;d<=t;)d+=e[o].size,o++;p=e.splice(o-1,e.length)}for(stableSort(e,l),e=e.map(e=>({size:e.size,targets:[e.target],align:pick(e.align,.5)}));n;){for(o=e.length;o--;)g=e[o],c=(Math.min.apply(0,g.targets)+Math.max.apply(0,g.targets))/2,g.pos=clamp(c-g.size*g.align,0,r-g.size);for(o=e.length,n=!1;o--;)0<o&&e[o-1].pos+e[o-1].size>e[o].pos&&(e[o-1].size+=e[o].size,e[o-1].targets=e[o-1].targets.concat(e[o].targets),e[o-1].align=.5,e[o-1].pos+e[o-1].size>r&&(e[o-1].pos=r-e[o-1].size),e.splice(o,1),n=!0)}return a.push.apply(a,p),o=0,e.some(e=>{let t=0;return(e.targets||[]).some(()=>(a[o].pos=e.pos+t,void 0!==i&&Math.abs(a[o].pos-a[o].target)>i?(a.slice(0,o+1).forEach(e=>delete e.pos),a.reducedLen=(a.reducedLen||r)-.1*r,a.reducedLen>.1*r&&s(a,r,i),!0):(t+=a[o].size,o++,!1)))}),stableSort(a,l),a};export default RendererUtilities;