"use strict";import Axis from"../Axis/Axis.js";import Chart from"../Chart/Chart.js";import F from"../../Core/FormatUtilities.js";const format=F["format"];import D from"../Defaults.js";const getOptions=D["getOptions"];import NavigatorDefaults from"../../Stock/Navigator/NavigatorDefaults.js";import RangeSelectorDefaults from"../../Stock/RangeSelector/RangeSelectorDefaults.js";import ScrollbarDefaults from"../../Stock/Scrollbar/ScrollbarDefaults.js";import Series from"../Series/Series.js";import SVGRenderer from"../Renderer/SVG/SVGRenderer.js";import U from"../Utilities.js";const{addEvent,clamp,defined,extend,find,isNumber,isString,merge,pick,splat}=U;import"../Pointer.js";class StockChart extends Chart{init(e,t){const s=getOptions(),i=e.xAxis,r=e.yAxis,o=pick(e.navigator&&e.navigator.enabled,NavigatorDefaults.enabled,!0),a=(e.xAxis=e.yAxis=void 0,merge({chart:{panning:{enabled:!0,type:"x"},zooming:{pinchType:"x"}},navigator:{enabled:o},scrollbar:{enabled:pick(ScrollbarDefaults.enabled,!0)},rangeSelector:{enabled:pick(RangeSelectorDefaults.rangeSelector.enabled,!0)},title:{text:null},tooltip:{split:pick(s.tooltip.split,!0),crosshairs:!0},legend:{enabled:!1}},e,{isStock:!0}));e.xAxis=i,e.yAxis=r,a.xAxis=splat(e.xAxis||{}).map(function(t,i){return merge(getDefaultAxisOptions("xAxis",t),s.xAxis,s.xAxis&&s.xAxis[i],t,getForcedAxisOptions("xAxis",e))}),a.yAxis=splat(e.yAxis||{}).map(function(t,i){return merge(getDefaultAxisOptions("yAxis",t),s.yAxis,s.yAxis&&s.yAxis[i],t)}),super.init(a,t)}createAxis(t,i){return i.axis=merge(getDefaultAxisOptions(t,i.axis),i.axis,getForcedAxisOptions(t,this.userOptions)),super.createAxis(t,i)}}function getDefaultAxisOptions(t,i){return"xAxis"===t?{minPadding:0,maxPadding:0,overscroll:0,ordinal:!0,title:{text:null},labels:{overflow:"justify"},showLastLabel:!0}:"yAxis"===t?{labels:{y:-2},opposite:pick(i.opposite,!0),showLastLabel:!(!i.categories&&"category"!==i.type),title:{text:null}}:{}}function getForcedAxisOptions(t,i){if("xAxis"!==t)return{};{const e={type:"datetime",categories:void 0};return pick(i.navigator&&i.navigator.enabled,NavigatorDefaults.enabled,!0)&&(e.startOnTick=!1,e.endOnTick=!1),e}}!function(s){s.stockChart=function(t,i,e){return new s(t,i,e)}}(StockChart=StockChart||{}),addEvent(Series,"setOptions",function(t){let i;this.chart.options.isStock&&(this.is("column")||this.is("columnrange")?i={borderWidth:0,shadow:!1}:this.is("scatter")||this.is("sma")||(i={marker:{enabled:!1,radius:2}}),i&&(t.plotOptions[this.type]=merge(t.plotOptions[this.type],i)))}),addEvent(Axis,"autoLabelAlign",function(t){const{chart:i,options:e}=this,s=i._labelPanes=i._labelPanes||{},r=e.labels;var o;i.options.isStock&&"yAxis"===this.coll&&(o=e.top+","+e.height,!s[o]&&r.enabled&&(15===r.distance&&1===this.side&&(r.distance=0),void 0===r.align&&(r.align="right"),s[o]=this,t.align="right",t.preventDefault()))}),addEvent(Axis,"destroy",function(){const t=this.chart,i=this.options&&this.options.top+","+this.options.height;i&&t._labelPanes&&t._labelPanes[i]===this&&delete t._labelPanes[i]}),addEvent(Axis,"getPlotLinePath",function(t){let s=this,r=(this.isLinked&&!this.series?this.linkedParent:this).series,o=s.chart,i=o.renderer,e=s.left,a=s.top,n,l,h,c,d=[],p=[],x,f,g=t.translatedValue,u=t.value,m=t.force,b;(o.options.isStock&&!1!==t.acrossPanes&&"xAxis"===s.coll||"yAxis"===s.coll)&&(t.preventDefault(),p=function(t){const i="xAxis"===t?"yAxis":"xAxis",e=s.options[i];return isNumber(e)?[o[i][e]]:isString(e)?[o.get(e)]:r.map(function(t){return t[i]})}(s.coll),(x=s.isXAxis?o.yAxis:o.xAxis).forEach(function(t){var i;defined(t.options.id)&&-1!==t.options.id.indexOf("navigator")||(i=t.isXAxis?"yAxis":"xAxis",i=defined(t.options[i])?o[i][t.options[i]]:o[i][0],s===i&&p.push(t))}),f=p.length?[]:[(s.isXAxis?o.yAxis:o.xAxis)[0]],p.forEach(function(i){-1!==f.indexOf(i)||find(f,function(t){return t.pos===i.pos&&t.len===i.len})||f.push(i)}),b=pick(g,s.translate(u,void 0,void 0,t.old)),isNumber(b)&&(s.horiz?f.forEach(function(t){let i;l=t.pos,c=l+t.len,n=h=Math.round(b+s.transB),"pass"!==m&&(n<e||n>e+s.width)&&(m?n=h=clamp(n,e,e+s.width):i=!0),i||d.push(["M",n,l],["L",h,c])}):f.forEach(function(t){let i;n=t.pos,h=n+t.len,l=c=Math.round(a+s.height-b),"pass"!==m&&(l<a||l>a+s.height)&&(m?l=c=clamp(l,a,a+s.height):i=!0),i||d.push(["M",n,l],["L",h,c])})),t.path=0<d.length?i.crispPolyLine(d,t.lineWidth||1):null)}),SVGRenderer.prototype.crispPolyLine=function(i,e){for(let t=0;t<i.length;t+=2){const s=i[t],r=i[t+1];s[1]===r[1]&&(s[1]=r[1]=Math.round(s[1])-e%2/2),s[2]===r[2]&&(s[2]=r[2]=Math.round(s[2])+e%2/2)}return i},addEvent(Axis,"afterHideCrosshair",function(){this.crossLabel&&(this.crossLabel=this.crossLabel.hide())}),addEvent(Axis,"afterDrawCrosshair",function(D){if(this.crosshair&&this.crosshair.label&&this.crosshair.label.enabled&&this.cross&&isNumber(this.min)&&isNumber(this.max)){let t=this.chart,i=this.logarithmic,e=this.crosshair.label,s=this.horiz,r=this.opposite,o=this.left,a=this.top,n=this.width,l=this.crossLabel,h,c,d,p=e.format,x="",f,g,u="inside"===this.options.tickPosition,m=!1!==this.crosshair.snap,b=0,A=D.e||this.cross&&this.cross.e,v=D.point,y=this.min,S=this.max;i&&(y=i.lin2log(y),S=i.lin2log(S)),g=s?"center":r?"right"===this.labelAlign?"right":"left":"left"===this.labelAlign?"left":"center",l||(l=this.crossLabel=t.renderer.label("",0,void 0,e.shape||"callout").addClass("highcharts-crosshair-label highcharts-color-"+(v&&v.series?v.series.colorIndex:this.series[0]&&this.series[0].colorIndex)).attr({align:e.align||g,padding:pick(e.padding,8),r:pick(e.borderRadius,3),zIndex:2}).add(this.labelGroup),t.styledMode||l.attr({fill:e.backgroundColor||v&&v.series&&v.series.color||"#666666",stroke:e.borderColor||"","stroke-width":e.borderWidth||0}).css(extend({color:"#ffffff",fontWeight:"normal",fontSize:"0.7em",textAlign:"center"},e.style||{}))),c=s?(h=m?(v.plotX||0)+o:A.chartX,a+(r?0:this.height)):(h=o+this.offset+(r?n:0),m?(v.plotY||0)+a:A.chartY),p||e.formatter||(this.dateTime&&(x="%b %d, %Y"),p="{value"+(x?":"+x:"")+"}");var D=m?this.isXAxis?v.x:v.y:this.toValue(s?A.chartX:A.chartY),O=v&&v.series?v.series.isPointInside(v):isNumber(D)&&D>y&&D<S;let k="";p?k=format(p,{value:D},t):e.formatter&&isNumber(D)&&(k=e.formatter.call(this,D)),l.attr({text:k,x:h,y:c,visibility:O?"inherit":"hidden"}),d=l.getBBox(),!isNumber(l.x)||s||r||(h=l.x-d.width/2),isNumber(l.y)&&(s?(u&&!r||!u&&r)&&(c=l.y-d.height):c=l.y-d.height/2),f=s?{left:o-d.x,right:o+this.width-d.x}:{left:"left"===this.labelAlign?o:0,right:"right"===this.labelAlign?o+this.width:t.chartWidth},l.translateX<f.left&&(b=f.left-l.translateX),l.translateX+d.width>=f.right&&(b=-(l.translateX+d.width-f.right)),l.attr({x:h+b,y:c,anchorX:s?h:this.opposite?0:t.chartWidth,anchorY:s?this.opposite?t.chartHeight:0:c+d.height/2})}}),Series.prototype.forceCropping=function(){var t=this.chart,i=this.options.dataGrouping;return!1!==this.allowDG&&i&&pick(i.enabled,t.options.isStock)},addEvent(Chart,"update",function(t){const i=t.options;"scrollbar"in i&&this.navigator&&(merge(!0,this.options.scrollbar,i.scrollbar),this.navigator.update({}),delete i.scrollbar)});export default StockChart;