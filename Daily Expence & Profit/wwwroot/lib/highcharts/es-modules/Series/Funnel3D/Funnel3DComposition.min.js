"use strict";import Color from"../../Core/Color/Color.js";const color=Color["parse"];import H from"../../Core/Globals.js";const charts=H["charts"];import SVGRenderer3D from"../../Core/Renderer/SVG/SVGRenderer3D.js";import U from"../../Core/Utilities.js";const{error,extend,merge}=U;import"../../Core/Renderer/SVG/SVGRenderer.js";var Funnel3DComposition;(Funnel3DComposition||(Funnel3DComposition={})).compose=function(e){SVGRenderer3D.compose(e),(r=e.prototype.elements3d).funnel3d=merge(r.cuboid,{parts:["top","bottom","frontUpper","backUpper","frontLower","backLower","rightUpper","rightLower"],mainParts:["top","bottom"],sideGroups:["upperGroup","lowerGroup"],sideParts:{upperGroup:["frontUpper","backUpper","rightUpper"],lowerGroup:["frontLower","backLower","rightLower"]},pathType:"funnel3d",opacitySetter:function(e){const r=this,t=r.parts,o=H.charts[r.renderer.chartIndex],n="group-opacity-"+e+"-"+o.index;return r.parts=r.mainParts,r.singleSetterForParts("opacity",e),r.parts=t,o.renderer.filterId||(o.renderer.definition({tagName:"filter",attributes:{id:n},children:[{tagName:"feComponentTransfer",children:[{tagName:"feFuncA",attributes:{type:"table",tableValues:"0 "+e}}]}]}),r.sideGroups.forEach(function(e){r[e].attr({filter:"url(#"+n+")"})}),r.renderer.styledMode&&(o.renderer.definition({tagName:"style",textContent:".highcharts-"+n+" {filter:url(#"+n+")}"}),r.sideGroups.forEach(function(e){e.addClass("highcharts-"+n)}))),r},fillSetter:function(e){let i=this,n=color(e),r=n.rgba[3],a={top:color(e).brighten(.1).get(),bottom:color(e).brighten(-.2).get()};return r<1?(n.rgba[3]=1,n=n.get("rgb"),i.attr({opacity:r})):n=e,(n=n.linearGradient||n.radialGradient||!i.gradientForSides?n:{linearGradient:{x1:0,x2:1,y1:1,y2:1},stops:[[0,color(e).brighten(-.2).get()],[.5,e],[1,color(e).brighten(-.2).get()]]}).linearGradient?i.sideGroups.forEach(function(e){const r=i[e].gradientBox,t=n.linearGradient,o=merge(n,{linearGradient:{x1:r.x+t.x1*r.width,y1:r.y+t.y1*r.height,x2:r.x+t.x2*r.width,y2:r.y+t.y2*r.height}});i.sideParts[e].forEach(function(e){a[e]=o})}):(merge(!0,a,{frontUpper:n,backUpper:n,rightUpper:n,frontLower:n,backLower:n,rightLower:n}),n.radialGradient&&i.sideGroups.forEach(function(e){const r=i[e].gradientBox,t=r.x+r.width/2,o=r.y+r.height/2,n=Math.min(r.width,r.height);i.sideParts[e].forEach(function(e){i[e].setRadialReference([t,o,n])})})),i.singleSetterForParts("fill",null,a),i.color=i.fill=e,n.linearGradient&&[i.frontLower,i.frontUpper].forEach(function(e){const r=e.element,t=r&&i.renderer.gradients[r.gradient];t&&"userSpaceOnUse"!==t.attr("gradientUnits")&&t.attr({gradientUnits:"userSpaceOnUse"})}),i},adjustForGradient:function(){let n=this,i;n.sideGroups.forEach(function(e){let t={x:Number.MAX_VALUE,y:Number.MAX_VALUE},o={x:-Number.MAX_VALUE,y:-Number.MAX_VALUE};n.sideParts[e].forEach(function(e){const r=n[e];i=r.getBBox(!0),t={x:Math.min(t.x,i.x),y:Math.min(t.y,i.y)},o={x:Math.max(o.x,i.x+i.width),y:Math.max(o.y,i.y+i.height)}}),n[e].gradientBox={x:t.x,width:o.x-t.x,y:t.y,height:o.y-t.y}})},zIndexSetter:function(){return this.finishedOnAdd&&this.adjustForGradient(),this.renderer.Element.prototype.zIndexSetter.apply(this,arguments)},onAdd:function(){this.adjustForGradient(),this.finishedOnAdd=!0}});{var r=e;const y=r.prototype;return void extend(y,{funnel3d:function(e){const r=this,t=r.element3d("funnel3d",e),o=r.styledMode,n={"stroke-width":1,stroke:"none"};return t.upperGroup=r.g("funnel3d-upper-group").attr({zIndex:t.frontUpper.zIndex}).add(t),[t.frontUpper,t.backUpper,t.rightUpper].forEach(function(e){o||e.attr(n),e.add(t.upperGroup)}),t.lowerGroup=r.g("funnel3d-lower-group").attr({zIndex:t.frontLower.zIndex}).add(t),[t.frontLower,t.backLower,t.rightLower].forEach(function(e){o||e.attr(n),e.add(t.lowerGroup)}),t.gradientForSides=e.gradientForSides,t},funnel3dPath:function(e){this.getCylinderEnd||error("A required Highcharts module is missing: cylinder.js",!0,charts[this.chartIndex]);let r=this,t=charts[r.chartIndex],o=e.alphaCorrection=90-Math.abs(t.options.chart.options3d.alpha%180-90),n=y.cuboidPath.call(r,merge(e,{depth:e.width,width:(e.width+e.bottom.width)/2})),i=n.isTop,a=!n.isFront,d=!!e.middle,p=r.getCylinderEnd(t,merge(e,{x:e.x-e.width/2,z:e.z-e.width/2,alphaCorrection:o})),s=e.bottom.width,h=merge(e,{width:s,x:e.x-s/2,z:e.z-s/2,alphaCorrection:o}),l=r.getCylinderEnd(t,h,!0),c=s,g=h,u=l,f=l,m,x;return d&&(c=e.middle.width,g=merge(e,{y:e.y+e.middle.fraction*e.height,width:c,x:e.x-c/2,z:e.z-c/2}),u=r.getCylinderEnd(t,g,!1),f=r.getCylinderEnd(t,g,!1)),(m={top:p,bottom:l,frontUpper:r.getCylinderFront(p,u),zIndexes:{group:n.zIndexes.group,top:0!==i?0:3,bottom:1!==i?0:3,frontUpper:a?2:1,backUpper:a?1:2,rightUpper:a?2:1}}).backUpper=r.getCylinderBack(p,u),x=Math.min(c,e.width)/Math.max(c,e.width)!=1,m.rightUpper=r.getCylinderFront(r.getCylinderEnd(t,merge(e,{x:e.x-e.width/2,z:e.z-e.width/2,alphaCorrection:x?-o:0}),!1),r.getCylinderEnd(t,merge(g,{alphaCorrection:x?-o:0}),!d)),d&&(x=Math.min(c,s)/Math.max(c,s)!=1,merge(!0,m,{frontLower:r.getCylinderFront(f,l),backLower:r.getCylinderBack(f,l),rightLower:r.getCylinderFront(r.getCylinderEnd(t,merge(h,{alphaCorrection:x?-o:0}),!0),r.getCylinderEnd(t,merge(g,{alphaCorrection:x?-o:0}),!1)),zIndexes:{frontLower:a?2:1,backLower:a?1:2,rightLower:a?1:2}})),m}})}};export default Funnel3DComposition;