"use strict";import A from"../../Core/Animation/AnimationUtilities.js";const animObject=A["animObject"];import ApproximationRegistry from"../../Extensions/DataGrouping/ApproximationRegistry.js";import H from"../../Core/Globals.js";import OnSeriesComposition from"../OnSeriesComposition.js";import SeriesRegistry from"../../Core/Series/SeriesRegistry.js";const{series:Series,seriesTypes:{column:ColumnSeries}}=SeriesRegistry;import U from"../../Core/Utilities.js";const{extend,merge,pick}=U;import WindbarbPoint from"./WindbarbPoint.js";class WindbarbSeries extends ColumnSeries{constructor(){super(...arguments),this.data=void 0,this.options=void 0,this.points=void 0}static registerApproximation(){ApproximationRegistry.windbarb||(ApproximationRegistry.windbarb=function(t,i){let e=0,r=0,o,s=t.length;for(o=0;o<s;o++)e+=t[o]*Math.cos(i[o]*H.deg2rad),r+=t[o]*Math.sin(i[o]*H.deg2rad);return[t.reduce(function(t,i){return t+i},0)/t.length,Math.atan2(r,e)/H.deg2rad]})}init(t,i){WindbarbSeries.registerApproximation(),Series.prototype.init.call(this,t,i)}pointAttribs(t,i){let e=this.options,r=t.color||this.color,o=this.options.lineWidth;return i&&(r=e.states[i].color||r,o=(e.states[i].lineWidth||o)+(e.states[i].lineWidthPlus||0)),{stroke:r,"stroke-width":o}}windArrow(t){let i=1.943844*t.value,e=t.beaufortLevel,r,o,s=this.options.vectorLength/20,n=-10;if(t.isNull)return[];if(0===e)return this.chart.renderer.symbols.circle(-10*s,-10*s,20*s,20*s);if(r=[["M",0,7*s],["L",-1.5*s,7*s],["L",0,10*s],["L",1.5*s,7*s],["L",0,7*s],["L",0,-10*s]],0<(o=(i-i%50)/50))for(;o--;)r.push(-10===n?["L",0,n*s]:["M",0,n*s],["L",5*s,n*s+2],["L",0,n*s+4]),i-=50,n+=7;if(0<(o=(i-i%10)/10))for(;o--;)r.push(-10===n?["L",0,n*s]:["M",0,n*s],["L",7*s,n*s]),i-=10,n+=3;if(0<(o=(i-i%5)/5))for(;o--;)r.push(-10===n?["L",0,n*s]:["M",0,n*s],["L",4*s,n*s]),i-=5,n+=3;return r}drawPoints(){const r=this.chart,o=this.yAxis,s=r.inverted,n=this.options.vectorLength/2;this.points.forEach(function(t){var i=t.plotX,e=t.plotY;!1===this.options.clip||r.isInsidePlot(i,0)?(t.graphic||(t.graphic=this.chart.renderer.path().add(this.markerGroup).addClass("highcharts-point highcharts-color-"+pick(t.colorIndex,t.series.colorIndex))),t.graphic.attr({d:this.windArrow(t),translateX:i+this.options.xOffset,translateY:e+this.options.yOffset,rotation:t.direction}),this.chart.styledMode||t.graphic.attr(this.pointAttribs(t))):t.graphic&&(t.graphic=t.graphic.destroy()),t.tooltipPos=[i+this.options.xOffset+(s&&!this.onSeries?n:0),e+this.options.yOffset-(s?0:n+o.pos-r.plotTop)]},this)}animate(t){t?this.markerGroup.attr({opacity:.01}):this.markerGroup.animate({opacity:1},animObject(this.options.animation))}markerAttribs(t,i){return{}}getExtremes(){return{}}shouldShowTooltip(t,i,e={}){return e.ignoreX=this.chart.inverted,e.ignoreY=!e.ignoreX,super.shouldShowTooltip(t,i,e)}}WindbarbSeries.defaultOptions=merge(ColumnSeries.defaultOptions,{dataGrouping:{enabled:!0,approximation:"windbarb",groupPixelWidth:30},lineWidth:2,onSeries:null,states:{hover:{lineWidthPlus:0}},tooltip:{pointFormat:'<span style="color:{point.color}">‚óè</span> {series.name}: <b>{point.value}</b> ({point.beaufort})<br/>'},vectorLength:20,colorKey:"value",yOffset:-20,xOffset:0}),OnSeriesComposition.compose(WindbarbSeries),extend(WindbarbSeries.prototype,{beaufortFloor:[0,.3,1.6,3.4,5.5,8,10.8,13.9,17.2,20.8,24.5,28.5,32.7],beaufortName:["Calm","Light air","Light breeze","Gentle breeze","Moderate breeze","Fresh breeze","Strong breeze","Near gale","Gale","Strong gale","Storm","Violent storm","Hurricane"],invertible:!1,parallelArrays:["x","value","direction"],pointArrayMap:["value","direction"],pointClass:WindbarbPoint,trackerGroups:["markerGroup"],translate:function(){const e=this.beaufortFloor,r=this.beaufortName;OnSeriesComposition.translate.call(this),this.points.forEach(function(t){let i=0;for(;i<e.length&&!(e[i]>t.value);i++);t.beaufortLevel=i-1,t.beaufort=r[i-1]})}}),WindbarbSeries.registerApproximation(),SeriesRegistry.registerSeriesType("windbarb",WindbarbSeries);export default WindbarbSeries;