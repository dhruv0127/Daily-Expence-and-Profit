"use strict";import H from"../../Core/Globals.js";const deg2rad=H["deg2rad"];import U from"../../Core/Utilities.js";const{extend,find,isNumber,isObject,merge}=U;function isRectanglesIntersecting(t,e){return!(e.left>t.right||e.right<t.left||e.top>t.bottom||e.bottom<t.top)}function getNormals(t,e){var o=e[0]-t[0],e=e[1]-t[1];return[[-e,o],[e,-o]]}function getAxesFromPolygon(t){let e,i=t.axes||[];return i.length||(i=[],e=e=t.concat([t[0]]),e.reduce(function(t,e){const o=getNormals(t,e),n=o[0];return find(i,t=>t[0]===n[0]&&t[1]===n[1])||i.push(n),e}),t.axes=i),i}function project(t,o){t=t.map(t=>{var e=t[0],t=t[1];return e*o[0]+t*o[1]});return{min:Math.min.apply(this,t),max:Math.max.apply(this,t)}}function isPolygonsOverlappingOnAxis(t,e,o){e=project(e,t),o=project(o,t);return!!(o.min>e.max||o.max<e.min)}function isPolygonsColliding(e,o){const t=getAxesFromPolygon(e),n=getAxesFromPolygon(o),i=t.concat(n),r=!find(i,t=>isPolygonsOverlappingOnAxis(t,e,o));return r}function intersectsAnyWord(o,t){function n(t){let e=isRectanglesIntersecting(i,t.rect);return e=e&&(o.rotation%90||t.rotation%90)?isPolygonsColliding(r,t.polygon):e}let e=!1,i=o.rect,r=o.polygon,a=o.lastCollidedWith;return a&&!(e=n(a))&&delete o.lastCollidedWith,e=e||!!find(t,function(t){var e=n(t);return e&&(o.lastCollidedWith=t),e})}function archimedeanSpiral(t,e){let o=e.field,n=!1,i=o.width*o.width+o.height*o.height,r=.8*t;return t<=1e4&&(n={x:r*Math.cos(r),y:r*Math.sin(r)},Math.min(Math.abs(n.x),Math.abs(n.y))<i||(n=!1)),n}function squareSpiral(t,e){function o(t){return"boolean"==typeof t}let n=4*t,i=Math.ceil((Math.sqrt(n)-1)/2),r=2*i+1,a=Math.pow(r,2),l=!1;return--r,t<=1e4&&(o(l)&&n>=a-r&&(l={x:i-(a-n),y:-i}),a-=r,o(l)&&n>=a-r&&(l={x:-i,y:-i+(a-n)}),a-=r,(l=o(l)?n>=a-r?{x:-i+(a-n),y:i}:{x:i,y:i-(a-n-r)}:l).x*=5,l.y*=5),l}function rectangularSpiral(t,e){const o=squareSpiral(t,e),n=e.field;return o&&(o.x*=n.ratioX,o.y*=n.ratioY),o}function getRandomPosition(t){return Math.round(t*(Math.random()+.5)/2)}function getScale(t,e,o){var n=2*Math.max(Math.abs(o.top),Math.abs(o.bottom)),o=2*Math.max(Math.abs(o.left),Math.abs(o.right));return Math.min(0<o?1/o*t:1,0<n?1/n*e:1)}function getPlayingField(t,e,o){var o=o.reduce(function(t,e){var e=e.dimensions,o=Math.max(e.width,e.height);return t.maxHeight=Math.max(t.maxHeight,e.height),t.maxWidth=Math.max(t.maxWidth,e.width),t.area+=o*o,t},{maxHeight:0,maxWidth:0,area:0}),o=Math.max(o.maxHeight,o.maxWidth,.85*Math.sqrt(o.area)),n=e<t?t/e:1,e=t<e?e/t:1;return{width:o*n,height:o*e,ratioX:n,ratioY:e}}function getRotation(t,e,o,n){let i=!1;return i=isNumber(t)&&isNumber(e)&&isNumber(o)&&isNumber(n)&&0<t&&-1<e&&o<n?o+e%t*((n-o)/(t-1||1)):i}function getSpiral(t,e){let o,n=[];for(o=1;o<1e4;o++)n.push(t(o,e));return function(t){return t<=1e4&&n[t-1]}}function outsidePlayingField(t,e){const o=-e.width/2,n=e.width/2,i=-e.height/2,r=e.height/2;return!(o<t.left&&n>t.right&&i<t.top&&r>t.bottom)}function movePolygon(e,o,t){return t.map(function(t){return[t[0]+e,t[1]+o]})}function intersectionTesting(t,e){let o=e.placed,n=e.field,i=e.rectangle,r=e.polygon,a=e.spiral,l=1,g={x:0,y:0},u=t.rect=extend({},i);for(t.polygon=r,t.rotation=e.rotation;!1!==g&&(intersectsAnyWord(t,o)||outsidePlayingField(u,n));)g=a(l),isObject(g)&&(u.left=i.left+g.x,u.right=i.right+g.x,u.top=i.top+g.y,u.bottom=i.bottom+g.y,t.polygon=movePolygon(g.x,g.y,r)),l++;return g}function extendPlayingField(t,e){let o,n,i,r,a,l,g,u;return u=isObject(t)&&isObject(e)?(o=e.bottom-e.top,n=e.right-e.left,i=t.ratioX,l=(a=o*(r=t.ratioY)<n*i?n:o)*i,g=a*r,merge(t,{width:t.width+2*l,height:t.height+2*g})):t}function updateFieldBoundaries(t,e){return(!isNumber(t.left)||t.left>e.left)&&(t.left=e.left),(!isNumber(t.right)||t.right<e.right)&&(t.right=e.right),(!isNumber(t.top)||t.top>e.top)&&(t.top=e.top),(!isNumber(t.bottom)||t.bottom<e.bottom)&&(t.bottom=e.bottom),t}function correctFloat(t,e){e=isNumber(e)?e:14,e=Math.pow(10,e);return Math.round(t*e)/e}function getBoundingBoxFromPolygon(t){return t.reduce(function(t,e){var o=e[0],e=e[1];return t.left=Math.min(o,t.left),t.right=Math.max(o,t.right),t.bottom=Math.max(e,t.bottom),t.top=Math.min(e,t.top),t},{left:Number.MAX_VALUE,right:-Number.MAX_VALUE,bottom:-Number.MAX_VALUE,top:Number.MAX_VALUE})}function getPolygon(t,e,o,n,i){const r=[t,e],a=t-o/2,l=t+o/2,g=e-n/2,u=e+n/2,s=[[a,g],[l,g],[l,u],[a,u]];return s.map(function(t){return rotate2DToPoint(t,r,-i)})}function rotate2DToOrigin(t,e){var o=t[0],t=t[1],e=deg2rad*-e,n=Math.cos(e),e=Math.sin(e);return[correctFloat(o*n-t*e),correctFloat(o*e+t*n)]}function rotate2DToPoint(t,e,o){t=rotate2DToOrigin([t[0]-e[0],t[1]-e[1]],o);return[t[0]+e[0],t[1]+e[1]]}const WordcloudUtils={archimedeanSpiral:archimedeanSpiral,extendPlayingField:extendPlayingField,getBoundingBoxFromPolygon:getBoundingBoxFromPolygon,getPlayingField:getPlayingField,getPolygon:getPolygon,getRandomPosition:getRandomPosition,getRotation:getRotation,getScale:getScale,getSpiral:getSpiral,intersectionTesting:intersectionTesting,isPolygonsColliding:isPolygonsColliding,isRectanglesIntersecting:isRectanglesIntersecting,rectangularSpiral:rectangularSpiral,rotate2DToOrigin:rotate2DToOrigin,rotate2DToPoint:rotate2DToPoint,squareSpiral:squareSpiral,updateFieldBoundaries:updateFieldBoundaries};export default WordcloudUtils;