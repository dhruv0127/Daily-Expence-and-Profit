"use strict";import SeriesRegistry from"../../Core/Series/SeriesRegistry.js";const{column:ColumnSeries}=SeriesRegistry["seriesTypes"];import VariwideComposition from"./VariwideComposition.js";import VariwidePoint from"./VariwidePoint.js";import U from"../../Core/Utilities.js";const{addEvent,extend,merge,pick}=U;class VariwideSeries extends ColumnSeries{constructor(){super(...arguments),this.data=void 0,this.options=void 0,this.points=void 0,this.relZ=void 0,this.totalZ=void 0,this.zData=void 0}processData(i){this.totalZ=0,this.relZ=[],SeriesRegistry.seriesTypes.column.prototype.processData.call(this,i),(this.xAxis.reversed?this.zData.slice().reverse():this.zData).forEach(function(i,t){this.relZ[t]=this.totalZ,this.totalZ+=i},this),this.xAxis.categories&&(this.xAxis.variwide=!0,this.xAxis.zData=this.zData)}postTranslate(i,t,s){const e=this.xAxis,r=this.relZ,o=e.reversed?r.length-i:i,a=e.reversed?-1:1,n=e.toPixels(e.reversed?(e.dataMax||0)+e.pointRange:e.dataMin||0),h=e.toPixels(e.reversed?e.dataMin||0:(e.dataMax||0)+e.pointRange),d=Math.abs(h-n),p=this.totalZ,l=this.chart.inverted?h-(this.chart.plotTop-a*e.minPixelPadding):n-this.chart.plotLeft-a*e.minPixelPadding,c=o/r.length*d,x=(o+a)/r.length*d,g=pick(r[o],p)/p*d,m=pick(r[o+a],p)/p*d,v=t-(l+c);return s&&(s.crosshairWidth=m-g),l+g+v*(m-g)/(x-c)}translate(){this.crispOption=this.options.crisp,this.options.crisp=!1,super.translate(),this.options.crisp=this.crispOption}correctStackLabels(){var i=this,t=i.options,s=i.yAxis;let e,r,o,a;for(const n of i.points)a=n.x,r=n.shapeArgs.width,(o=s.stacking.stacks[(i.negStacks&&n.y<(t.startFromThreshold?0:t.threshold)?"-":"")+i.stackKey])&&(e=o[a])&&!n.isNull&&e.setOffset(-r/2||0,r||0,void 0,void 0,n.plotX,i.xAxis)}}VariwideSeries.compose=VariwideComposition.compose,VariwideSeries.defaultOptions=merge(ColumnSeries.defaultOptions,{pointPadding:0,groupPadding:0}),addEvent(VariwideSeries,"afterColumnTranslate",function(){const p=this.xAxis,l=this.chart.inverted,c=this.borderWidth%2/2;this.points.forEach((i,t)=>{const s=i.shapeArgs||{},{x:e=0,width:r=0}=s,{plotX:o=0,tooltipPos:a,z:n=0}=i;let h,d;d=p.variwide?(h=this.postTranslate(t,e,i),this.postTranslate(t,e+r)):(h=o,p.translate(i.x+n,!1,!1,!1,!0)),this.crispOption&&(h=Math.round(h)-c,d=Math.round(d)-c),s.x=h,s.width=Math.max(d-h,1),i.plotX=(h+d)/2,a&&(l?a[1]=p.len-s.x-s.width/2:a[0]=s.x+s.width/2)}),this.options.stacking&&this.correctStackLabels()},{order:2}),extend(VariwideSeries.prototype,{irregularWidths:!0,pointArrayMap:["y","z"],parallelArrays:["x","y","z"],pointClass:VariwidePoint}),SeriesRegistry.registerSeriesType("variwide",VariwideSeries);export default VariwideSeries;