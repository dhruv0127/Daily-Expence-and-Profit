"use strict";import OrganizationPoint from"./OrganizationPoint.js";import OrganizationSeriesDefaults from"./OrganizationSeriesDefaults.js";import SeriesRegistry from"../../Core/Series/SeriesRegistry.js";import PathUtilities from"../PathUtilities.js";const{sankey:SankeySeries}=SeriesRegistry["seriesTypes"];import U from"../../Core/Utilities.js";const{css,extend,isNumber,merge,pick}=U;class OrganizationSeries extends SankeySeries{constructor(){super(...arguments),this.data=void 0,this.options=void 0,this.points=void 0}alignDataLabel(s,o,n){s=s.shapeArgs;if(n.useHTML&&s){let i=s.width||0,t=s.height||0,e=this.options.borderWidth+2*this.options.dataLabels.padding;this.chart.inverted&&(i=t,t=s.width||0),t-=e,i-=e;n=o.text;n&&(css(n.element.parentNode,{width:i+"px",height:t+"px"}),css(n.element,{left:0,top:0,width:"100%",height:"100%",overflow:"hidden"})),o.getBBox=()=>({width:i,height:t,x:0,y:0}),o.width=i,o.height=t}super.alignDataLabel.apply(this,arguments)}createNode(i){const t=super.createNode.call(this,i);return t.getSum=()=>1,t}pointAttribs(i,t){const e=this,s=SankeySeries.prototype.pointAttribs.call(e,i,t),o=(i.isNode?i:i.fromNode).level,n=e.mapOptionsToLevel[o||0]||{},a=i.options,r=n.states&&n.states[t]||{},h=pick(r.borderRadius,a.borderRadius,n.borderRadius,e.options.borderRadius),l=pick(r.linkColor,a.linkColor,n.linkColor,e.options.linkColor,r.link&&r.link.color,a.link&&a.link.color,n.link&&n.link.color,e.options.link&&e.options.link.color),p=pick(r.linkLineWidth,a.linkLineWidth,n.linkLineWidth,e.options.linkLineWidth,r.link&&r.link.lineWidth,a.link&&a.link.lineWidth,n.link&&n.link.lineWidth,e.options.link&&e.options.link.lineWidth),d=pick(r.linkOpacity,a.linkOpacity,n.linkOpacity,e.options.linkOpacity,r.link&&r.link.linkOpacity,a.link&&a.link.linkOpacity,n.link&&n.link.linkOpacity,e.options.link&&e.options.link.linkOpacity);return i.isNode?isNumber(h)&&(s.r=h):(s.stroke=l,s["stroke-width"]=p,s.opacity=d,delete s.fill),s}translateLink(l){var p=l.fromNode,d=l.toNode,g=pick(this.options.linkLineWidth,this.options.link.lineWidth),k=Math.round(g)%2/2,c=pick(this.options.link.offset,.5),f=pick(l.options.link&&l.options.link.type,this.options.link.type);if(p.shapeArgs&&d.shapeArgs){let i=Math.floor((p.shapeArgs.x||0)+(p.shapeArgs.width||0))+k,t=Math.floor((p.shapeArgs.y||0)+(p.shapeArgs.height||0)/2)+k,e=Math.floor(d.shapeArgs.x||0)+k,s=Math.floor((d.shapeArgs.y||0)+(d.shapeArgs.height||0)/2)+k,o,n=this.options.hangingIndent,a=d.options.offset,r=/%$/.test(a)&&parseInt(a,10),h=this.chart.inverted;h&&(i-=p.shapeArgs.width||0,e+=d.shapeArgs.width||0),o=this.colDistance?Math.floor(e+(h?1:-1)*(this.colDistance-this.nodeWidth)/2)+k:Math.floor((e+i)/2)+k,r&&(50<=r||r<=-50)&&(o=e=Math.floor(e+(h?-.5:.5)*(d.shapeArgs.width||0))+k,s=d.shapeArgs.y||0,0<r&&(s+=d.shapeArgs.height||0)),d.hangsFrom===p&&(this.chart.inverted?(t=Math.floor((p.shapeArgs.y||0)+(p.shapeArgs.height||0)-n/2)+k,s=(d.shapeArgs.y||0)+(d.shapeArgs.height||0)):t=Math.floor((p.shapeArgs.y||0)+n/2)+k,o=e=Math.floor((d.shapeArgs.x||0)+(d.shapeArgs.width||0)/2)+k),l.plotX=o,l.plotY=(t+s)/2,l.shapeType="path","straight"===f?l.shapeArgs={d:[["M",i,t],["L",e,s]]}:"curved"===f?(p=Math.abs(e-i)*c*(h?-1:1),l.shapeArgs={d:[["M",i,t],["C",i+p,t,e-p,s,e,s]]}):l.shapeArgs={d:PathUtilities.applyRadius([["M",i,t],["L",o,t],["L",o,s],["L",e,s]],pick(this.options.linkRadius,this.options.link.radius))},l.dlBox={x:(i+e)/2,y:(t+s)/2,height:g,width:0}}}translateNode(i,t){SankeySeries.prototype.translateNode.call(this,i,t);let e=i.hangsFrom,s=this.options.hangingIndent||0,o=this.chart.inverted?-1:1,n=i.shapeArgs,a=this.options.hangingIndentTranslation,r=this.options.minNodeLength||10;if(e)if("cumulative"===a)for(n.height-=s,n.y-=o*s;e;)n.y+=o*s,e=e.hangsFrom;else if("shrink"===a)for(;e&&n.height>s+r;)n.height-=s,e=e.hangsFrom;else n.height-=s,this.chart.inverted||(n.y+=s);i.nodeHeight=this.chart.inverted?n.width:n.height}drawDataLabels(){var i=this.options.dataLabels;if(i.linkTextPath&&i.linkTextPath.enabled)for(const t of this.points)t.options.dataLabels=merge(t.options.dataLabels,{useHTML:!1});super.drawDataLabels()}}OrganizationSeries.defaultOptions=merge(SankeySeries.defaultOptions,OrganizationSeriesDefaults),extend(OrganizationSeries.prototype,{pointClass:OrganizationPoint}),SeriesRegistry.registerSeriesType("organization",OrganizationSeries);export default OrganizationSeries;