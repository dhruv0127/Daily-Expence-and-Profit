"use strict";import DataLabel from"../../Core/Series/DataLabel.js";import H from"../../Core/Globals.js";const noop=H["noop"];import R from"../../Core/Renderer/RendererUtilities.js";const distribute=R["distribute"];import SeriesRegistry from"../../Core/Series/SeriesRegistry.js";const Series=SeriesRegistry["series"];import U from"../../Core/Utilities.js";const{arrayMax,clamp,defined,merge,pick,relativeLength}=U;var ColumnDataLabel;!function(t){const e=[],i={radialDistributionY:function(t){return t.top+t.distributeBox.pos},radialDistributionX:function(t,a,e,i){return t.getX(e<a.top+2||e>a.bottom-2?i:e,a.half,a)},justify:function(t,a,e){return e[0]+(t.half?-1:1)*(a+t.labelDistance)},alignToPlotEdges:function(t,a,e,i){t=t.getBBox().width;return a?t+i:e-t-i},alignToConnectors:function(t,a,e,i){let o=0,s;return t.forEach(function(t){(s=t.dataLabel.getBBox().width)>o&&(o=s)}),a?o+i:e-o-i}};function o(){const h=this,t=h.data,c=h.chart,b=h.options.dataLabels||{},u=b.connectorPadding,p=c.plotWidth,f=c.plotHeight,m=c.plotLeft,a=Math.round(c.chartWidth/3),L=h.center,x=L[2]/2,g=L[1],e=[[],[]],y=[0,0,0,0],D=h.dataLabelPositioners;let w,i,o,v,M,B,C,k,E,S,_,P;h.visible&&(b.enabled||h._hasPointLabels)&&(t.forEach(function(t){t.dataLabel&&t.visible&&t.dataLabel.shortened&&(t.dataLabel.attr({width:"auto"}).css({width:"auto",textOverflow:"clip"}),t.dataLabel.shortened=!1)}),Series.prototype.drawDataLabels.apply(h),t.forEach(function(t){t.dataLabel&&(t.visible?(e[t.half].push(t),t.dataLabel._pos=null,defined(b.style.width)||defined(t.options.dataLabels&&t.options.dataLabels.style&&t.options.dataLabels.style.width)||t.dataLabel.getBBox().width>a&&(t.dataLabel.css({width:Math.round(.7*a)+"px"}),t.dataLabel.shortened=!0)):(t.dataLabel=t.dataLabel.destroy(),t.dataLabels&&1===t.dataLabels.length&&delete t.dataLabels))}),e.forEach((t,a)=>{const e=t.length,i=[];let o,s,l,n,r=0,d;if(e)for(h.sortByAngle(t,a-.5),0<h.maxLabelDistance&&(o=Math.max(0,g-x-h.maxLabelDistance),s=Math.min(g+x+h.maxLabelDistance,c.plotHeight),t.forEach(function(t){0<t.labelDistance&&t.dataLabel&&(t.top=Math.max(0,g-x-t.labelDistance),t.bottom=Math.min(g+x+t.labelDistance,c.plotHeight),r=t.dataLabel.getBBox().height||21,t.distributeBox={target:t.labelPosition.natural.y-t.top+r/2,size:r,rank:t.y},i.push(t.distributeBox))}),d=s+r-o,distribute(i,d,d/5)),_=0;_<e;_++){if(w=t[_],B=w.labelPosition,v=w.dataLabel,S=!1===w.visible?"hidden":"inherit",l=B.natural.y,E=l,i&&defined(w.distributeBox)&&(void 0===w.distributeBox.pos?S="hidden":(C=w.distributeBox.size,E=D.radialDistributionY(w))),delete w.positionIndex,b.justify)k=D.justify(w,x,L);else switch(b.alignTo){case"connectors":k=D.alignToConnectors(t,a,p,m);break;case"plotEdges":k=D.alignToPlotEdges(v,a,p,m);break;default:k=D.radialDistributionX(h,w,E,l)}v._attr={visibility:S,align:B.alignment},P=w.options.dataLabels||{},v._pos={x:k+pick(P.x,b.x)+({left:u,right:-u}[B.alignment]||0),y:E+pick(P.y,b.y)-v.getBBox().height/2},B&&(B.computed.x=k,B.computed.y=E),pick(b.crop,!0)&&(M=v.getBBox().width,n=null,k-M<u&&1===a?(n=Math.round(M-k+u),y[3]=Math.max(n,y[3])):k+M>p-u&&0===a&&(n=Math.round(k+M-p+u),y[1]=Math.max(n,y[1])),E-C/2<0?y[0]=Math.max(Math.round(-E+C/2),y[0]):E+C/2>f&&(y[2]=Math.max(Math.round(E+C/2-f),y[2])),v.sideOverflow=n)}}),0!==arrayMax(y)&&!this.verifyDataLabelOverflow(y)||(this.placeDataLabels(),this.points.forEach(function(t){var a;P=merge(b,t.options.dataLabels),(i=pick(P.connectorWidth,1))&&(o=t.connector,(v=t.dataLabel)&&v._pos&&t.visible&&0<t.labelDistance?(S=v._attr.visibility,(a=!o)&&(t.connector=o=c.renderer.path().addClass("highcharts-data-label-connector  highcharts-color-"+t.colorIndex+(t.className?" "+t.className:"")).add(h.dataLabelsGroup),c.styledMode||o.attr({"stroke-width":i,stroke:P.connectorColor||t.color||"#666666"})),o[a?"attr":"animate"]({d:t.getConnectorPath()}),o.attr("visibility",S)):o&&(t.connector=o.destroy()))})))}function s(){this.points.forEach(function(t){let a=t.dataLabel,e;a&&t.visible&&((e=a._pos)?(a.sideOverflow&&(a._attr.width=Math.max(a.getBBox().width-a.sideOverflow,0),a.css({width:a._attr.width+"px",textOverflow:(this.options.dataLabels.style||{}).textOverflow||"ellipsis"}),a.shortened=!0),a.attr(a._attr),a[a.moved?"animate":"attr"](e),a.moved=!0):a&&a.attr({y:-9999})),delete t.distributeBox},this)}function l(t){let a=this.center,e=this.options,i=e.center,o=e.minSize||80,s=o,l=null!==e.size;return l||(null!==i[0]?s=Math.max(a[2]-Math.max(t[1],t[3]),o):(s=Math.max(a[2]-t[1]-t[3],o),a[0]+=(t[3]-t[1])/2),null!==i[1]?s=clamp(s,o,a[2]-Math.max(t[0],t[2])):(s=clamp(s,o,a[2]-t[0]-t[2]),a[1]+=(t[0]-t[2])/2),s<a[2]?(a[2]=s,a[3]=Math.min(e.thickness?Math.max(0,s-2*e.thickness):Math.max(0,relativeLength(e.innerSize||0,s)),s),this.translate(a),this.drawDataLabels&&this.drawDataLabels()):l=!0),l}t.compose=function(t){if(DataLabel.compose(Series),U.pushUnique(e,t)){const a=t.prototype;a.dataLabelPositioners=i,a.alignDataLabel=noop,a.drawDataLabels=o,a.placeDataLabels=s,a.verifyDataLabelOverflow=l}}}(ColumnDataLabel=ColumnDataLabel||{});export default ColumnDataLabel;