"use strict";import H from"../../Core/Globals.js";import ItemPoint from"./ItemPoint.js";import D from"../../Core/Defaults.js";const defaultOptions=D["defaultOptions"];import SeriesRegistry from"../../Core/Series/SeriesRegistry.js";const{pie:PieSeries}=SeriesRegistry["seriesTypes"];import U from"../../Core/Utilities.js";const{defined,extend,fireEvent,isNumber,merge,objectEach,pick}=U;class ItemSeries extends PieSeries{constructor(){super(...arguments),this.data=void 0,this.options=void 0,this.points=void 0}animate(t){t?this.group.attr({opacity:0}):this.group.animate({opacity:1},this.options.animation)}drawDataLabels(){this.center&&this.slots?H.seriesTypes.pie.prototype.drawDataLabels.call(this):this.points.forEach(function(t){t.destroyElements({dataLabel:1})})}drawPoints(){let m=this,f=this.options,y=m.chart.renderer,e=f.marker,t=this.borderWidth,v=t%2?.5:1,S=0,b=this.getRows(),M=Math.ceil(this.total/b),w=this.chart.plotWidth/M,A=this.chart.plotHeight/b,I=this.itemSize||Math.min(w,A);this.points.forEach(function(i){let s,o,r,t=i.marker||{},a=t.symbol||e.symbol,n=pick(t.radius,e.radius),h=defined(n)?2*n:I,l=h*f.itemPadding,p,d,c,g;if(i.graphics=o=i.graphics||[],m.chart.styledMode||(r=m.pointAttribs(i,i.selected&&"select")),!i.isNull&&i.visible){i.graphic||(i.graphic=y.g("point").add(m.group));for(let e=0;e<(i.y||0);e++){var u;d=m.center&&m.slots?(u=m.slots.shift(),p=u.x-I/2,u.y-I/2):"horizontal"===f.layout?(p=w*(S%M),A*Math.floor(S/M)):(p=w*Math.floor(S/b),A*(S%b)),p+=l,d+=l,g=c=Math.round(h-2*l),m.options.crisp&&(p=Math.round(p)-v,d=Math.round(d)+v),s={x:p,y:d,width:c,height:g},void 0!==n&&(s.r=n),r&&extend(s,r);let t=o[e];t?t.animate(s):t=y.symbol(a,void 0,void 0,void 0,void 0,{backgroundSize:"within"}).attr(s).add(i.graphic),t.isActive=!0,o[e]=t,S++}}o.forEach((t,e)=>{t&&(t.isActive?t.isActive=!1:(t.destroy(),o.splice(e,1)))})})}getRows(){let t=this.options.rows,e,i;if(!t)if(i=this.chart.plotWidth/this.chart.plotHeight,t=Math.sqrt(this.total),1<i)for(t=Math.ceil(t);0<t&&!((e=this.total/t)/t>i);)t--;else for(t=Math.floor(t);t<this.total&&!((e=this.total/t)/t<i);)t++;return t}getSlots(){let s=this.center,t=s[2],e=s[3],i,o=this.slots,r,a,n,h,l,p,d,c,g=0,u,m=this.endAngleRad-this.startAngleRad,f=Number.MAX_VALUE,y,v,S,b=this.options.rows,M=(t-e)/t,w=m%(2*Math.PI)==0,A=this.total||0;for(;f>A+(v&&w?v.length:0);)for(y=f,o.length=0,f=0,v=S,S=[],g++,u=t/g/2,b?0<=(e=(u-b)/u*t)?u=b:(e=0,M=1):u=Math.floor(u*M),i=u;0<i;i--)n=(e+i/u*(t-e-g))/2,h=m*n,l=Math.ceil(h/g),S.push({rowRadius:n,rowLength:h,colCount:l}),f+=l+1;if(v){let e=y-this.total-(w?v.length:0);for(;0<e;)v.map(function(t){return{angle:t.colCount/t.rowLength,row:t}}).sort(function(t,e){return e.angle-t.angle}).slice(0,Math.min(e,Math.ceil(v.length/2))).forEach(I);return v.forEach(function(t){var e=t.rowRadius,i=t.colCount;for(p=i?m/i:0,c=0;c<=i;c+=1)d=this.startAngleRad+c*p,r=s[0]+Math.cos(d)*e,a=s[1]+Math.sin(d)*e,o.push({x:r,y:a,angle:d})},this),o.sort(function(t,e){return t.angle-e.angle}),this.itemSize=g,o;function I(t){0<e&&(t.row.colCount--,e--)}}}translate(t){0===this.total&&isNumber(this.options.startAngle)&&isNumber(this.options.endAngle)&&(this.center=this.getCenter()),this.slots||(this.slots=[]),isNumber(this.options.startAngle)&&isNumber(this.options.endAngle)?(H.seriesTypes.pie.prototype.translate.apply(this,arguments),this.slots=this.getSlots()):(this.generatePoints(),fireEvent(this,"afterTranslate"))}}ItemSeries.defaultOptions=merge(PieSeries.defaultOptions,{endAngle:void 0,innerSize:"40%",itemPadding:.1,layout:"vertical",marker:merge(defaultOptions.plotOptions.line.marker,{radius:null}),rows:void 0,crisp:!1,showInLegend:!0,startAngle:void 0}),extend(ItemSeries.prototype,{markerAttribs:void 0}),ItemSeries.prototype.pointClass=ItemPoint,SeriesRegistry.registerSeriesType("item",ItemSeries);export default ItemSeries;