"use strict";import SeriesRegistry from"../../Core/Series/SeriesRegistry.js";const{column:ColumnSeries,line:LineSeries}=SeriesRegistry["seriesTypes"];import SVGElement from"../../Core/Renderer/SVG/SVGElement.js";import TimelinePoint from"./TimelinePoint.js";import TimelineSeriesDefaults from"./TimelineSeriesDefaults.js";import U from"../../Core/Utilities.js";const{addEvent,arrayMax,arrayMin,defined,extend,merge,pick}=U;class TimelineSeries extends LineSeries{constructor(){super(...arguments),this.data=void 0,this.options=void 0,this.points=void 0,this.userOptions=void 0,this.visibilityMap=void 0}alignDataLabel(e,i,t,s){let a=this,n=a.chart.inverted,r=a.visibilityMap.filter(function(e){return e}),o=a.visiblePointsCount,l=r.indexOf(e),p=!l||l===o-1,d=a.options.dataLabels,h=e.userDLOptions||{},u=d.alternate?p?1.5:2:1,c,m=Math.floor(a.xAxis.len/o),f=i.padding,b,x;e.visible&&(c=Math.abs(h.x||e.options.dataLabels.x),x=n?{width:(b=2*(c-f)-e.itemHeight/2)+"px",textOverflow:i.width/b*i.height/2>m*u?"ellipsis":"none"}:{width:(h.width||d.width||m*u-2*f)+"px"},i.css(x),a.chart.styledMode||i.shadow(d.shadow)),super.alignDataLabel.apply(a,arguments)}bindAxes(){const i=this;super.bindAxes.call(i),["xAxis","yAxis"].forEach(function(e){"xAxis"!==e||i[e].userOptions.type||(i[e].categories=i[e].hasNames=!0)})}distributeDL(){const i=this,t=i.options.dataLabels;let s=1;if(t){const a=t.distance||0;i.points.forEach(e=>{e.options.dataLabels=merge({[i.chart.inverted?"x":"y"]:t.alternate&&s%2?-a:a},e.userDLOptions),s++})}}generatePoints(){const t=this;super.generatePoints.apply(t),t.points.forEach(function(e,i){e.applyOptions({x:t.xData[i]},t.xData[i])})}getVisibilityMap(){var e=this;return(e.data.length?e:e.userOptions).data.map(function(e){return!(!e||!1===e.visible||e.isNull)&&e})}getXExtremes(e){const t=this,i=e.filter(function(e,i){return t.points[i].isValid()&&t.points[i].visible});return{min:arrayMin(i),max:arrayMax(i)}}init(){const e=this;super.init.apply(e,arguments),e.eventsToUnbind.push(addEvent(e,"afterTranslate",function(){let i,t=Number.MAX_VALUE;e.points.forEach(function(e){e.isInside=e.isInside&&e.visible,e.visible&&!e.isNull&&(defined(i)&&(t=Math.min(t,Math.abs(e.plotX-i))),i=e.plotX)}),e.closestPointRangePx=t})),e.eventsToUnbind.push(addEvent(e,"drawDataLabels",function(){e.distributeDL()})),e.eventsToUnbind.push(addEvent(e,"afterDrawDataLabels",function(){let i;e.points.forEach(function(e){if(i=e.dataLabel)return i.animate=function(e){return this.targetPosition&&(this.targetPosition=e),SVGElement.prototype.animate.apply(this,arguments)},i.targetPosition||(i.targetPosition={}),e.drawConnector()})})),e.eventsToUnbind.push(addEvent(e.chart,"afterHideOverlappingLabel",function(){e.points.forEach(function(e){e.connector&&e.dataLabel&&e.dataLabel.oldOpacity!==e.dataLabel.newOpacity&&e.alignConnector()})}))}markerAttribs(e,i){let t=this,s=t.options.marker,a,n=e.marker||{},r=n.symbol||s.symbol,o,l=pick(n.width,s.width,t.closestPointRangePx),p=pick(n.height,s.height),d=0,h;return t.xAxis.dateTime?super.markerAttribs.call(this,e,i):(i&&(a=s.states[i]||{},o=n.states&&n.states[i]||{},d=pick(o.radius,a.radius,d+(a.radiusPlus||0))),e.hasImage=r&&0===r.indexOf("url"),h={x:Math.floor(e.plotX)-l/2-d/2,y:e.plotY-p/2-d/2,width:l+d,height:p+d},t.chart.inverted?{y:h.x&&h.width&&t.xAxis.len-h.x-h.width,x:h.y,width:h.height,height:h.width}:h)}processData(){let e=this,i=0,t;for(e.visibilityMap=e.getVisibilityMap(),e.visibilityMap.forEach(function(e){e&&i++}),e.visiblePointsCount=i,t=0;t<e.xData.length;t++)e.yData[t]=1;super.processData.call(this,arguments)}}TimelineSeries.defaultOptions=merge(LineSeries.defaultOptions,TimelineSeriesDefaults),extend(TimelineSeries.prototype,{drawTracker:ColumnSeries.prototype.drawTracker,pointClass:TimelinePoint,trackerGroups:["markerGroup","dataLabelsGroup"]}),SeriesRegistry.registerSeriesType("timeline",TimelineSeries);export default TimelineSeries;