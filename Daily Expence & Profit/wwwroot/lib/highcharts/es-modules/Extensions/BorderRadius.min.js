"use strict";import D from"../Core/Defaults.js";const defaultOptions=D["defaultOptions"];import Series from"../Core/Series/Series.js";import SeriesRegistry from"../Core/Series/SeriesRegistry.js";const seriesTypes=SeriesRegistry["seriesTypes"];import SVGElement from"../Core/Renderer/SVG/SVGElement.js";import SVGRenderer from"../Core/Renderer/SVG/SVGRenderer.js";import U from"../Core/Utilities.js";const{addEvent,extend,isObject,merge,relativeLength}=U,defaultBorderRadiusOptions={radius:0,scope:"stack",where:void 0},optionsToObject=(t,e)=>(isObject(t)||(t={radius:t||0}),merge(defaultBorderRadiusOptions,e,t)),applyBorderRadius=(t,e,r)=>{var s=t[e];let o=t[e+1];"Z"===o[0]&&(o=t[0]);let a,i,n;if("M"!==s[0]&&"L"!==s[0]||"A"!==o[0]?"A"!==s[0]||"M"!==o[0]&&"L"!==o[0]||(a=o,i=s):(a=s,i=o,n=!0),a&&i&&i.params){const p=i[1],l=i[5],c=i.params,{start:u,end:m,cx:b,cy:M}=c;var s=l?p-r:p+r,d=s?Math.asin(r/s):0,h=l?d:-d,d=Math.cos(d)*s;n?(c.start=u+h,a[1]=b+d*Math.cos(u),a[2]=M+d*Math.sin(u),t.splice(e+1,0,["A",r,r,0,0,1,b+p*Math.cos(c.start),M+p*Math.sin(c.start)])):(c.end=m-h,i[6]=b+p*Math.cos(c.end),i[7]=M+p*Math.sin(c.end),t.splice(e+1,0,["A",r,r,0,0,1,b+d*Math.cos(m),M+d*Math.sin(m)])),i[4]=Math.abs(c.end-c.start)<Math.PI?0:1}};if(-1===SVGElement.symbolCustomAttribs.indexOf("borderRadius")){SVGElement.symbolCustomAttribs.push("borderRadius","brBoxHeight","brBoxY");const v=SVGRenderer.prototype.symbols.arc,w=(SVGRenderer.prototype.symbols.arc=function(t,e,r,s,o={}){var a=v(t,e,r,s,o),{innerR:t=0,r:e=r,start:s=0,end:r=0}=o;if(o.open||!o.borderRadius)return a;var r=r-s,s=Math.sin(r/2),i=Math.max(Math.min(relativeLength(o.borderRadius||0,e-t),(e-t)/2,e*s/(1+s)),0),n=Math.min(i,r/Math.PI*2*t);let d=a.length-1;for(;d--;)applyBorderRadius(a,d,1<d?n:i);return a},SVGRenderer.prototype.symbols.roundedRect);SVGRenderer.prototype.symbols.roundedRect=function(t,e,r,s,o={}){const a=w(t,e,r,s,o),{r:i=0,brBoxHeight:n=s,brBoxY:d=e}=o,h=e-d,p=d+n-(e+s),l=-.1<h-i?0:i,c=-.1<p-i?0:i,u=Math.max(l&&h,0),m=Math.max(c&&p,0),b=[t+l,e],M=[t+r-l,e],f=[t+r,e+l],R=[t+r,e+s-c],y=[t+r-c,e+s],v=[t+c,e+s],g=[t,e+s-c],S=[t,e+l];var x,o=(t,e)=>Math.sqrt(Math.pow(t,2)-Math.pow(e,2));return u&&(x=o(l,l-u),b[0]-=x,M[0]+=x,f[1]=S[1]=e+l-u),s<l-u&&(x=o(l,l-u-s),f[0]=R[0]=t+r-l+x,y[0]=Math.min(f[0],y[0]),v[0]=Math.max(R[0],v[0]),g[0]=S[0]=t+l-x,f[1]=S[1]=e+s),m&&(x=o(c,c-m),y[0]+=x,v[0]-=x,R[1]=g[1]=e+s-c+m),s<c-m&&(x=o(c,c-m-s),f[0]=R[0]=t+r-c+x,M[0]=Math.min(f[0],M[0]),b[0]=Math.max(R[0],b[0]),g[0]=S[0]=t+c-x,R[1]=g[1]=e),a.length=0,a.push(["M",...b],["L",...M],["A",l,l,0,0,1,...f],["L",...R],["A",c,c,0,0,1,...y],["L",...v],["A",c,c,0,0,1,...g],["L",...S],["A",l,l,0,0,1,...b],["Z"]),a},addEvent(seriesTypes.pie,"afterTranslate",function(){var t=optionsToObject(this.options.borderRadius);for(const e of this.points){const r=e.shapeArgs;r&&(r.borderRadius=relativeLength(t.radius,(r.r||0)-(r.innerR||0)))}}),addEvent(Series,"afterColumnTranslate",function(){var t;if(this.options.borderRadius&&(!this.chart.is3d||!this.chart.is3d())){const{options:d,yAxis:h}=this,p="percent"===d.stacking,e=null==(t=null==(t=defaultOptions.plotOptions)?void 0:t[this.type])?void 0:t.borderRadius,l=optionsToObject(d.borderRadius,isObject(e)?e:{}),c=h.options.reversed;for(const u of this.points){var s=u["shapeArgs"];if("roundedRect"===u.shapeType&&s){var{width:o=0,height:a=0,y:i=0}=s;let t=i,e=a;"stack"===l.scope&&u.stackTotal&&(i=h.translate(p?100:u.stackTotal,!1,!0,!1,!0),n=h.translate(d.threshold||0,!1,!0,!1,!0),i=this.crispCol(0,Math.min(i,n),0,Math.abs(i-n)),t=i.y,e=i.height);var n=(u.negative?-1:1)*(c?-1:1)==-1;let r=l.where;r=(r=!r&&this.is("waterfall")&&Math.abs((u.yBottom||0)-(this.translatedThreshold||0))>this.borderWidth?"all":r)||"end";i=Math.min(relativeLength(l.radius,o),o/2,"all"===r?a/2:1/0)||0;"end"===r&&(n&&(t-=i),e+=i),extend(s,{brBoxHeight:e,brBoxY:t,r:i})}}}},{order:9})}const BorderRadius={optionsToObject:optionsToObject};export default BorderRadius;