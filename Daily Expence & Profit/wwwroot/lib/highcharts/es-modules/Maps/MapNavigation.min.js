"use strict";import Chart from"../Core/Chart/Chart.js";import H from"../Core/Globals.js";const doc=H["doc"];import U from"../Core/Utilities.js";const{addEvent,extend,isNumber,merge,objectEach,pick}=U;import"./MapNavigationDefaults.js";function stopEvent(t){t&&(t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0)}function MapNavigation(t){this.navButtons=[],this.init(t)}MapNavigation.prototype.init=function(t){this.chart=t},MapNavigation.prototype.update=function(t){function l(t){this.handler.call(p,t),stopEvent(t)}let u=this,p=this.chart,c=p.options.mapNavigation,g,b=u.navButtons;for(t&&(c=p.options.mapNavigation=merge(p.options.mapNavigation,t));b.length;)b.pop().destroy();if(pick(c.enableButtons,c.enabled)&&!p.renderer.forExport){u.navButtonsGroup||(u.navButtonsGroup=p.renderer.g().attr({zIndex:4}).add()),objectEach(c.buttons,function(t,o){t=merge(c.buttonOptions,t),!p.styledMode&&t.theme&&((g=t.theme).style=merge(t.theme.style,t.style));var{text:e,width:n=0,height:i=0,padding:a=0}=t;const s=p.renderer.button("+"!==e&&"-"!==e&&e||"",0,0,l,g,void 0,void 0,void 0,"zoomIn"===o?"topbutton":"bottombutton").addClass("highcharts-map-navigation highcharts-"+{zoomIn:"zoom-in",zoomOut:"zoom-out"}[o]).attr({width:n,height:i,title:p.options.lang[o],padding:t.padding,zIndex:5}).add(u.navButtonsGroup);if("+"===e||"-"===e){const r=n+1,h=[["M",a+3,a+i/2],["L",a+r-3,a+i/2]];"+"===e&&h.push(["M",a+r/2,a+3],["L",a+r/2,a+i-3]),p.renderer.path(h).addClass("highcharts-button-symbol").attr(p.styledMode?{}:{stroke:null==(o=t.style)?void 0:o.color,"stroke-width":3,"stroke-linecap":"round"}).add(s)}if(s.handler=t.onclick,addEvent(s.element,"dblclick",stopEvent),b.push(s),extend(t,{width:s.width,height:2*s.height}),p.hasLoaded)s.align(t,!1,t.alignTo);else{const d=addEvent(p,"load",()=>{s.element&&s.align(t,!1,t.alignTo),d()})}});const n=(t,o)=>!(o.x>=t.x+t.width||o.x+o.width<=t.x||o.y>=t.y+t.height||o.y+o.height<=t.y);p.hasLoaded||addEvent(p,"render",function(){var t,o,e=p.exportingGroup&&p.exportingGroup.getBBox();e&&(o=u.navButtonsGroup.getBBox(),n(e,o)&&(t=-o.y-o.height+e.y-5,e=e.y+e.height-o.y+5,o=c.buttonOptions&&c.buttonOptions.verticalAlign,u.navButtonsGroup.attr({translateY:"bottom"===o?t:e})))})}this.updateEvents(c)},MapNavigation.prototype.updateEvents=function(t){const o=this.chart;pick(t.enableDoubleClickZoom,t.enabled)||t.enableDoubleClickZoomTo?this.unbindDblClick=this.unbindDblClick||addEvent(o.container,"dblclick",function(t){o.pointer.onContainerDblClick(t)}):this.unbindDblClick&&(this.unbindDblClick=this.unbindDblClick()),pick(t.enableMouseWheelZoom,t.enabled)?this.unbindMouseWheel=this.unbindMouseWheel||addEvent(o.container,void 0!==doc.onwheel?"wheel":void 0!==doc.onmousewheel?"mousewheel":"DOMMouseScroll",function(t){return o.pointer.inClass(t.target,"highcharts-no-mousewheel")||(o.pointer.onContainerMouseWheel(t),stopEvent(t)),!1}):this.unbindMouseWheel&&(this.unbindMouseWheel=this.unbindMouseWheel())},extend(Chart.prototype,{fitToBox:function(e,n){return[["x","width"],["y","height"]].forEach(function(t){var o=t[0],t=t[1];e[o]+e[t]>n[o]+n[t]&&(e[t]>n[t]?(e[t]=n[t],e[o]=n[o]):e[o]=n[o]+n[t]-e[t]),e[t]>n[t]&&(e[t]=n[t]),e[o]<n[o]&&(e[o]=n[o])}),e},mapZoom:function(t,o,e,n,i){this.mapView&&(isNumber(t)&&(t=Math.log(t)/Math.log(.5)),this.mapView.zoomBy(t,isNumber(o)&&isNumber(e)?this.mapView.projection.inverse([o,e]):void 0,isNumber(n)&&isNumber(i)?[n,i]:void 0))}}),addEvent(Chart,"beforeRender",function(){this.mapNavigation=new MapNavigation(this),this.mapNavigation.update()}),H.MapNavigation=MapNavigation;