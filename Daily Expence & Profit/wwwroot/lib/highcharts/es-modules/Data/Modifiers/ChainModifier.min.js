"use strict";import DataModifier from"./DataModifier.js";import U from"../../Core/Utilities.js";const merge=U["merge"];class ChainModifier extends DataModifier{constructor(i,...o){super(),this.chain=o,this.options=merge(ChainModifier.defaultOptions,i);var r=this.options.chain||[];for(let i=0,e=r.length,t;i<e;++i)(t=DataModifier.types[r[i].modifier])&&o.unshift(new t(r[i]))}add(i,e){this.emit({type:"addModifier",detail:e,modifier:i}),this.chain.push(i),this.emit({type:"addModifier",detail:e,modifier:i})}clear(i){this.emit({type:"clearChain",detail:i}),this.chain.length=0,this.emit({type:"afterClearChain",detail:i})}modify(e,t){var o=this.options.reverse?this.chain.slice().reverse():this.chain.slice();let r=Promise.resolve(e);for(let i=0,e=o.length;i<e;++i){const s=o[i];r=r.then(i=>s.modify(i.modified,t))}return r=(r=r.then(i=>(e.modified=i.modified,e))).catch(i=>{throw this.emit({type:"error",detail:t,table:e}),i})}modifyCell(i,o,r,s,d){const h=this.options.reverse?this.chain.reverse():this.chain;if(h.length){let t=i.clone();for(let i=0,e=h.length;i<e;++i)h[i].modifyCell(t,o,r,s,d),t=t.modified;i.modified=t}return i}modifyColumns(i,o,r,s){const d=this.options.reverse?this.chain.reverse():this.chain.slice();if(d.length){let t=i.clone();for(let i=0,e=d.length;i<e;++i)d[i].modifyColumns(t,o,r,s),t=t.modified;i.modified=t}return i}modifyRows(i,o,r,s){const d=this.options.reverse?this.chain.reverse():this.chain.slice();if(d.length){let t=i.clone();for(let i=0,e=d.length;i<e;++i)d[i].modifyRows(t,o,r,s),t=t.modified;i.modified=t}return i}modifyTable(i,o){var e=this,r=(e.emit({type:"modify",detail:o,table:i}),e.options.reverse?e.chain.reverse():e.chain.slice());let s=i.modified;for(let i=0,e=r.length,t;i<e;++i)t=r[i],s=t.modifyTable(s,o).modified;return i.modified=s,e.emit({type:"afterModify",detail:o,table:i}),i}remove(i,e){const t=this.chain;this.emit({type:"removeModifier",detail:e,modifier:i}),t.splice(t.indexOf(i),1),this.emit({type:"afterRemoveModifier",detail:e,modifier:i})}}ChainModifier.defaultOptions={modifier:"Chain"},DataModifier.registerType("Chain",ChainModifier);export default ChainModifier;