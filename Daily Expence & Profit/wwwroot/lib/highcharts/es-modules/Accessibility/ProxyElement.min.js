"use strict";import H from"../Core/Globals.js";const doc=H["doc"];import U from"../Core/Utilities.js";const{attr,css,merge}=U;import EventProvider from"./Utils/EventProvider.js";import ChartUtilities from"./Utils/ChartUtilities.js";const fireEventOnWrappedOrUnwrappedElement=ChartUtilities["fireEventOnWrappedOrUnwrappedElement"];import HTMLUtilities from"./Utils/HTMLUtilities.js";const{cloneMouseEvent,cloneTouchEvent,getFakeMouseEvent,removeElement}=HTMLUtilities;class ProxyElement{constructor(t,e,i,o){this.chart=t,this.target=e;i="ul"===(this.groupType=i);this.eventProvider=new EventProvider;const r=i?doc.createElement("li"):null;var s=this.buttonElement=doc.createElement("button");t.styledMode||this.hideButtonVisually(s),r?(i&&!t.styledMode&&(r.style.listStyle="none"),r.appendChild(s),this.element=r):this.element=s,this.updateTarget(e,o)}click(){const t=this.getTargetPosition();t.x+=t.width/2,t.y+=t.height/2;var e=getFakeMouseEvent("click",t);fireEventOnWrappedOrUnwrappedElement(this.target.click,e)}updateTarget(t,e){this.target=t,this.updateCSSClassName();const i=e||{};Object.keys(i).forEach(t=>{null===i[t]&&delete i[t]}),attr(this.buttonElement,merge({"aria-label":this.getTargetAttr(t.click,"aria-label")},i)),this.eventProvider.removeAddedEvents(),this.addProxyEventsToButton(this.buttonElement,t.click),this.refreshPosition()}refreshPosition(){var t=this.getTargetPosition();css(this.buttonElement,{width:(t.width||1)+"px",height:(t.height||1)+"px",left:(Math.round(t.x)||0)+"px",top:(Math.round(t.y)||0)+"px"})}remove(){this.eventProvider.removeAddedEvents(),removeElement(this.element)}updateCSSClassName(){var t=t=>-1<t.indexOf("highcharts-no-tooltip"),e=this.chart.legend,e=e.group&&e.group.div,e=t(e&&e.className||""),t=t(this.getTargetAttr(this.target.click,"class")||"");this.buttonElement.className=e||t?"highcharts-a11y-proxy-button highcharts-no-tooltip":"highcharts-a11y-proxy-button"}addProxyEventsToButton(e,o){["click","touchstart","touchend","touchcancel","touchmove","mouseover","mouseenter","mouseleave","mouseout"].forEach(t=>{const i=0===t.indexOf("touch");this.eventProvider.addEvent(e,t,t=>{var e=(i?cloneTouchEvent:cloneMouseEvent)(t);o&&fireEventOnWrappedOrUnwrappedElement(o,e),t.stopPropagation(),i||t.preventDefault()},{passive:!1})})}hideButtonVisually(t){css(t,{borderWidth:0,backgroundColor:"transparent",cursor:"pointer",outline:"none",opacity:.001,filter:"alpha(opacity=1)",zIndex:999,overflow:"hidden",padding:0,margin:0,display:"block",position:"absolute","-ms-filter":"progid:DXImageTransform.Microsoft.Alpha(Opacity=1)"})}getTargetPosition(){var t,e=this.target.click,e=e.element||e;const i=this.target.visual||e;return this.chart.renderTo&&i&&i.getBoundingClientRect?(e=i.getBoundingClientRect(),t=this.chart.pointer.getChartPosition(),{x:(e.left-t.left)/t.scaleX,y:(e.top-t.top)/t.scaleY,width:e.right/t.scaleX-e.left/t.scaleX,height:e.bottom/t.scaleY-e.top/t.scaleY}):{x:0,y:0,width:1,height:1}}getTargetAttr(t,e){return(t.element||t).getAttribute(e)}}export default ProxyElement;