"use strict";!function(e){"object"==typeof module&&module.exports?module.exports=e.default=e:"function"==typeof define&&define.amd?define("highcharts/modules/treegraph",["highcharts","highcharts/modules/treemap"],function(t){return e(t),e.Highcharts=t,e}):e("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(t){function e(t,e,i,s){t.hasOwnProperty(e)||(t[e]=s.apply(null,i),"function"==typeof CustomEvent&&window.dispatchEvent(new CustomEvent("HighchartsModuleLoaded",{detail:{path:e,module:t[e]}})))}e(t=t?t._modules:{},"Series/PathUtilities.js",[],function(){function h(e,i){const s=[];for(let t=0;t<e.length;t++){var o=e[t][1],r=e[t][2];if("number"==typeof o&&"number"==typeof r)if(0===t)s.push(["M",o,r]);else if(t===e.length-1)s.push(["L",o,r]);else if(i){var n=e[t-1],a=e[t+1];if(n&&a){const e=n[1];var l,h,n=n[2],d=a[1],a=a[2];"number"==typeof e&&"number"==typeof d&&"number"==typeof n&&"number"==typeof a&&e!==d&&n!==a&&(l=e<d?1:-1,h=n<a?1:-1,s.push(["L",o-l*Math.min(Math.abs(o-e),i),r-h*Math.min(Math.abs(r-n),i)],["C",o,r,o,r,o+l*Math.min(Math.abs(o-d),i),r+h*Math.min(Math.abs(r-a),i)]))}}else s.push(["L",o,r])}return s}return{applyRadius:h,getLinkPath:{default:function(t){var{x1:e,y1:i,x2:s,y2:o,width:r=0,inverted:n=!1,radius:a,parentVisible:l}=t;return t=[["M",e,i],["L",e,i],["C",e,i,e,o,e,o],["L",e,o],["C",e,i,e,o,e,o],["L",e,o]],l?h([["M",e,i],["L",e+r*(n?-.5:.5),i],["L",e+r*(n?-.5:.5),o],["L",s,o]],a):t},straight:function(t){var{x1:t,y1:e,x2:i,y2:s,width:o=0,inverted:r=!1,parentVisible:n}=t;return n?[["M",t,e],["L",t+o*(r?-1:1),s],["L",i,s]]:[["M",t,e],["L",t,s],["L",t,s]]},curved:function(t){var{x1:t,y1:e,x2:i,y2:s,offset:o=0,width:r=0,inverted:n=!1,parentVisible:a}=t;return a?[["M",t,e],["C",t+o,e,t-o+r*(n?-1:1),s,t+r*(n?-1:1),s],["L",i,s]]:[["M",t,e],["C",t,e,t,s,t,s],["L",i,s]]}}}}),e(t,"Series/Treegraph/TreegraphNode.js",[t["Core/Series/SeriesRegistry.js"]],function(t){({treemap:{prototype:{NodeClass:t}}}=t.seriesTypes);class e extends t{constructor(){super(...arguments),this.change=this.shift=this.mod=0,this.children=[],this.preX=0,this.collapsed=this.wasVisited=this.hidden=!1}nextLeft(){return this.getLeftMostChild()||this.thread}nextRight(){return this.getRightMostChild()||this.thread}getAncestor(t,e){return t.ancestor.children[0]===this.children[0]?t.ancestor:e}getLeftMostSibling(){var t=this.getParent();if(t)for(const e of t.children)if(e&&e.point.visible)return e}hasChildren(){var e=this.children;for(let t=0;t<e.length;t++)if(e[t].point.visible)return!0;return!1}getLeftSibling(){var e=this.getParent();if(e){e=e.children;for(let t=this.relativeXPosition-1;0<=t;t--)if(e[t]&&e[t].point.visible)return e[t]}}getLeftMostChild(){var e=this.children;for(let t=0;t<e.length;t++)if(e[t].point.visible)return e[t]}getRightMostChild(){var e=this.children;for(let t=e.length-1;0<=t;t--)if(e[t].point.visible)return e[t]}getParent(){return this.parentNode}getFirstChild(){var e=this.children;for(let t=0;t<e.length;t++)if(e[t].point.visible)return e[t]}}return e}),e(t,"Series/Treegraph/TreegraphPoint.js",[t["Core/Series/Point.js"],t["Core/Series/SeriesRegistry.js"],t["Core/Utilities.js"]],function(t,e,i){({treemap:{prototype:{pointClass:e}}}=e.seriesTypes);const{addEvent:s,fireEvent:o,merge:d,pick:r}=i;class n extends e{constructor(){super(...arguments),this.options=void 0,this.isLink=!1,this.node=this.series=void 0,this.setState=t.prototype.setState}draw(){super.draw.apply(this,arguments);let t=this.graphic;t&&t.animate({visibility:this.visible?"inherit":"hidden"}),this.renderCollapseButton()}renderCollapseButton(){var t,e,i,s=this.series;const o=this.graphic&&this.graphic.parentGroup,{width:r,height:n,shape:a,style:l}=s=d(s.options.collapseButton,(s.mapOptionsToLevel[this.node.level||0]||{}).collapseButton,this.options.collapseButton),h=this.series.chart;if(this.shapeArgs)if(this.collapseButtonOptions=s,this.collapseButton)if(this.node.children.length&&s.enabled){const{x:o,y:d}=this.getCollapseBtnPosition(s);this.collapseButton.attr({text:this.collapsed?"+":"-",rotation:h.inverted?90:0,rotationOriginX:r/2,rotationOriginY:n/2}).animate({x:o,y:d,opacity:!this.visible||s.onlyOnHover&&"hover"!==this.state&&!this.collapsed?0:1})}else this.collapseButton.destroy(),delete this.collapseButton;else this.node.children.length&&s.enabled&&({x:t,y:e}=this.getCollapseBtnPosition(s),i=s.fillColor||this.color||"#cccccc",this.collapseButton=h.renderer.label(this.collapsed?"+":"-",t,e,a).attr({height:n-4,width:r-4,padding:2,fill:i,rotation:h.inverted?90:0,rotationOriginX:r/2,rotationOriginY:n/2,stroke:s.lineColor||"#ffffff","stroke-width":s.lineWidth,"text-align":"center",align:"center",zIndex:1}).addClass("highcharts-tracker").addClass("highcharts-collapse-button").removeClass("highcharts-no-tooltip").css(d({color:"string"==typeof i?h.renderer.getContrast(i):"#333333"},l)).add(o),this.collapseButton.element.point=this,s.onlyOnHover&&!this.collapsed&&this.collapseButton.attr({opacity:0}))}toggleCollapse(t){this.collapsed=r(t,!this.collapsed),o(this.series,"toggleCollapse"),this.series.redraw()}destroy(){this.collapseButton&&(this.collapseButton.destroy(),delete this.collapseButton,this.collapseButton=void 0),super.destroy.apply(this,arguments)}getCollapseBtnPosition(t){var e=this.series.chart.inverted,i=t.width,s=t.height,{x:o=0,y:r=0,width:n=0,height:a=0}=this.shapeArgs||{};return{x:o+t.x+(e?.3*-s:n+-.3*i),y:r+a/2-s/2+t.y}}}return s(n,"mouseOut",function(){const t=this.collapseButton,e=this.collapseButtonOptions;t&&e&&e.onlyOnHover&&!this.collapsed&&t.animate({opacity:0})}),s(n,"mouseOver",function(){this.collapseButton&&this.collapseButton.animate({opacity:1},this.series.options.states&&this.series.options.states.hover&&this.series.options.states.hover.animation)}),s(n,"click",function(){this.toggleCollapse()}),n}),e(t,"Series/Treegraph/TreegraphLink.js",[t["Core/Series/Point.js"],t["Core/Utilities.js"],t["Core/Series/SeriesRegistry.js"]],function(r,t,e){const{pick:n,extend:a}=t;({column:{prototype:{pointClass:t}}}=e.seriesTypes);class i extends t{constructor(){super(...arguments),this.isLink=!0,this.node={},this.formatPrefix="link",this.dataLabelOnNull=!0}init(t,e,i,s){const o=super.init.apply(this,arguments);return this.formatPrefix="link",this.dataLabelOnNull=!0,s&&(o.fromNode=s.node.parentNode.point,o.visible=s.visible,o.toNode=s,this.id=o.toNode.id+"-"+o.fromNode.id),o}update(t,e,i,s){var o={id:this.id,formatPrefix:this.formatPrefix};r.prototype.update.call(this,t,!this.isLink&&e,i,s),this.visible=this.toNode.visible,a(this,o),n(e,!0)&&this.series.chart.redraw(i)}}return i}),e(t,"Series/Treegraph/TreegraphLayout.js",[t["Series/Treegraph/TreegraphNode.js"]],function(o){class r{static createDummyNode(t,e,i,s){return(s=new o).id=t.id+"-"+i,s.ancestor=t,s.children.push(e),s.parent=t.id,s.parentNode=t,s.point=e.point,s.level=e.level-i,s.relativeXPosition=e.relativeXPosition,s.visible=e.visible,t.children[e.relativeXPosition]=s,e.oldParentNode=t,e.relativeXPosition=0,e.parentNode=s,e.parent=s.id,s}calculatePositions(t){var e=t.nodeList;this.resetValues(e),(t=t.tree)&&(this.calculateRelativeX(t,0),this.beforeLayout(e),this.firstWalk(t),this.secondWalk(t,-t.preX),this.afterLayout(e))}beforeLayout(e){for(const s of e){e=0;for(var i of s.children){if(i&&1<i.level-s.level){let t=i.level-s.level-1;for(;0<t;)i=r.createDummyNode(s,i,t,e),t--}++e}}}resetValues(t){for(const e of t)e.mod=0,e.ancestor=e,e.shift=0,e.thread=void 0,e.change=0,e.preX=0}calculateRelativeX(t,e){var i=t.children;for(let t=0,e=i.length;t<e;++t)this.calculateRelativeX(i[t],t);t.relativeXPosition=e}firstWalk(t){if(t.hasChildren()){var e,i=t.getLeftMostChild();for(e of t.children)this.firstWalk(e),i=this.apportion(e,i);this.executeShifts(t),i=t.getLeftMostChild(),e=t.getRightMostChild(),e=(i.preX+e.preX)/2,(i=t.getLeftSibling())?(t.preX=i.preX+1,t.mod=t.preX-e):t.preX=e}else(i=t.getLeftSibling())?(t.preX=i.preX+1,t.mod=t.preX):t.preX=0}secondWalk(t,e){t.yPosition=t.preX+e,t.xPosition=t.level;for(const i of t.children)this.secondWalk(i,e+t.mod)}executeShifts(e){let i=0,s=0;for(let t=e.children.length-1;0<=t;t--){const o=e.children[t];o.preX+=i,o.mod+=i,s+=o.change,i+=o.shift+s}}apportion(a,l){var h=a.getLeftSibling();if(h){let t=a,e=a,i=t.getLeftMostSibling(),s=t.mod,o=e.mod,r=h.mod,n=i.mod;for(;h&&h.nextRight()&&t&&t.nextLeft();){h=h.nextRight(),i=i.nextLeft(),t=t.nextLeft(),(e=e.nextRight()).ancestor=a;var d=h.preX+r-(t.preX+s)+1;0<d&&(this.moveSubtree(a.getAncestor(h,l),a,d),s+=d,o+=d),r+=h.mod,s+=t.mod,n+=i.mod,o+=e.mod}h&&h.nextRight()&&!e.nextRight()&&(e.thread=h.nextRight(),e.mod+=r-o),t&&t.nextLeft()&&!i.nextLeft()&&(i.thread=t.nextLeft(),i.mod+=s-n),l=a}return l}moveSubtree(t,e,i){var s=e.relativeXPosition-t.relativeXPosition;e.change-=i/s,e.shift+=i,e.preX+=i,e.mod+=i,t.change+=i/s}afterLayout(t){for(const e of t)e.oldParentNode&&(e.relativeXPosition=e.parentNode.relativeXPosition,e.parent=e.oldParentNode.parent,e.parentNode=e.oldParentNode,delete e.oldParentNode.children[e.relativeXPosition],e.oldParentNode.children[e.relativeXPosition]=e,e.oldParentNode=void 0)}}return r}),e(t,"Series/Treegraph/TreegraphSeriesDefaults.js",[],function(){return{reversed:!1,marker:{radius:10,lineWidth:0,symbol:"circle",fillOpacity:1,states:{}},link:{color:"#666666",lineWidth:1,radius:10,cursor:"default",type:"curved"},collapseButton:{onlyOnHover:!0,enabled:!0,lineWidth:1,x:0,y:0,height:18,width:18,shape:"circle",style:{cursor:"pointer",fontWeight:"bold",fontSize:"1em"}},tooltip:{linkFormat:"{point.fromNode.id} â†’ {point.toNode.id}",pointFormat:"{point.id}"},dataLabels:{defer:!0,linkTextPath:{attributes:{startOffset:"50%"}},enabled:!0,linkFormatter:()=>"",style:{textOverflow:"none"}}}}),e(t,"Series/Treegraph/TreegraphSeries.js",[t["Series/PathUtilities.js"],t["Core/Series/SeriesRegistry.js"],t["Core/Renderer/SVG/SVGRenderer.js"],t["Series/Treegraph/TreegraphNode.js"],t["Series/Treegraph/TreegraphPoint.js"],t["Series/TreeUtilities.js"],t["Core/Utilities.js"],t["Series/Treegraph/TreegraphLink.js"],t["Series/Treegraph/TreegraphLayout.js"],t["Series/Treegraph/TreegraphSeriesDefaults.js"]],function(t,e,i,s,o,r,n,a,l,h){const u=t["getLinkPath"],{series:{prototype:d},seriesTypes:{treemap:p,column:c}}=e,{symbols:v}=i["prototype"],f=r["getLevelOptions"],{extend:y,merge:m,pick:k,relativeLength:b,splat:g}=n;class L extends p{constructor(){super(...arguments),this.tree=this.nodeMap=this.layoutModifier=this.points=this.options=this.data=void 0,this.nodeList=[],this.layoutAlgorythm=void 0,this.links=[],this.mapOptionsToLevel=void 0}init(){super.init.apply(this,arguments),this.layoutAlgorythm=new l}getLayoutModifiers(){var t=this.chart;const r=this,n=t.plotSizeX,a=t.plotSizeY;let l=1/0,h=-1/0,d=1/0,p=-1/0,c=0,u=0,f=0,g=0;this.points.forEach(t=>{const e=t.node;t=m(this.options.marker,(r.mapOptionsToLevel[t.node.level]||{}).marker,t.options.marker);var i=b(t.radius||0,Math.min(n,a)),s=t.symbol,o="circle"!==s&&t.height?b(t.height,a):2*i,i="circle"!==s&&t.width?b(t.width,n):2*i;e.nodeSizeX=i,e.nodeSizeY=o,e.xPosition<=l&&(l=e.xPosition,s=t.lineWidth||0,u=Math.max(i+s,u)),e.xPosition>=h&&(h=e.xPosition,s=t.lineWidth||0,c=Math.max(i+s,c)),e.yPosition<=d&&(d=e.yPosition,s=t.lineWidth||0,g=Math.max(o+s,g)),e.yPosition>=p&&(p=e.yPosition,s=t.lineWidth||0,f=Math.max(o+s,f))});var t=p===d?1:(a-(g+f)/2)/(p-d),e=h===l?1:(n-(c+c)/2)/(h-l);return{ax:e,bx:h===l?n/2:-e*l+u/2,ay:t,by:p===d?a/2:-t*d+g/2}}getLinks(){const i=this,s=[];return this.data.forEach((t,e)=>{e=i.mapOptionsToLevel[t.node.level||0]||{},t.node.parent?(e=m(e,t.options),!t.linkToParent||t.linkToParent.destroyed?(e=(new i.LinkClass).init(i,e,void 0,t),t.linkToParent=e):t.linkToParent.update({collapsed:e.collapsed},!1),t.linkToParent.index=s.push(t.linkToParent)-1):t.linkToParent&&(i.links.splice(t.linkToParent.index),t.linkToParent.destroy(),delete t.linkToParent)}),s}buildTree(t,e,i,s,o){var r=this.points[e];return i=r&&r.level||i,super.buildTree.call(this,t,e,i,s,o)}markerAttribs(){return{}}setCollapsedStatus(t,e){const i=t.point;i&&(i.collapsed=k(i.collapsed,(this.mapOptionsToLevel[t.level]||{}).collapsed),e=!1!==(i.visible=e)&&!i.collapsed),t.children.forEach(t=>{this.setCollapsedStatus(t,e)})}drawTracker(){c.prototype.drawTracker.apply(this,arguments),c.prototype.drawTracker.call(this,this.links)}translate(){var t=this.options;let e=r.updateRootId(this),i;d.translate.call(this);var s=this.tree=this.getTree();i=this.nodeMap[e],""===e||i&&i.children.length||(this.setRootNode("",!1),e=this.rootNode,i=this.nodeMap[e]),this.mapOptionsToLevel=f({from:i.level+1,levels:t.levels,to:s.height,defaults:{levelIsConstant:this.options.levelIsConstant,colorByPoint:t.colorByPoint}}),this.setCollapsedStatus(s,!0),this.links=this.getLinks(),this.setTreeValues(s),this.layoutAlgorythm.calculatePositions(this),this.layoutModifier=this.getLayoutModifiers(),this.points.forEach(t=>{this.translateNode(t)}),this.points.forEach(t=>{t.linkToParent&&this.translateLink(t.linkToParent)}),t.colorByPoint||this.setColorRecursive(this.tree)}translateLink(i){var s=i.fromNode,o=i.toNode,r=this.options.link.lineWidth,n=Math.round(r)%2/2,a=k(this.options.link.curveFactor,.5),l=k(i.options.link&&i.options.link.type,this.options.link.type);if(s.shapeArgs&&o.shapeArgs){var h=s.shapeArgs.width||0,d=this.chart.inverted,p=Math.floor((s.shapeArgs.y||0)+(s.shapeArgs.height||0)/2)+n,c=Math.floor((o.shapeArgs.y||0)+(o.shapeArgs.height||0)/2)+n;let t=Math.floor((s.shapeArgs.x||0)+h)+n,e=Math.floor(o.shapeArgs.x||0)+n;d&&(t-=h,e+=o.shapeArgs.width||0),s=o.node.xPosition-s.node.xPosition,i.shapeType="path",a=(h=(Math.abs(e-t)+h)/s-h)*a*(d?-1:1),i.plotX=Math.floor((e+t)/2)+n,i.plotY=c,i.shapeArgs={d:u[l]({x1:t,y1:p,x2:e,y2:c,width:h,offset:a,inverted:d,parentVisible:o.visible,radius:this.options.link.radius})},i.dlBox={x:(t+e)/2,y:(p+c)/2,height:r,width:0},i.tooltipPos=d?[(this.chart.plotSizeY||0)-i.dlBox.y,(this.chart.plotSizeX||0)-i.dlBox.x]:[i.dlBox.x,i.dlBox.y]}}drawNodeLabels(t){var e=this.mapOptionsToLevel;let i,s;for(const o of t)s=e[o.node.level],i={style:{}},s&&s.dataLabels&&(i=m(i,s.dataLabels),this._hasPointLabels=!0),o.shapeArgs&&!g(this.options.dataLabels)[0].style.width&&(i.style.width=o.shapeArgs.width,o.dataLabel&&o.dataLabel.css({width:o.shapeArgs.width+"px"})),o.dlOptions=m(i,o.options.dataLabels);d.drawDataLabels.call(this,t)}alignDataLabel(t,e){var i=t.visible;t.visible=!0,super.alignDataLabel.apply(this,arguments),e.animate({opacity:!1===i?0:1}),t.visible=i}drawDataLabels(){this.options.dataLabels&&(this.options.dataLabels=g(this.options.dataLabels),this.drawNodeLabels(this.points),d.drawDataLabels.call(this,this.links))}destroy(){if(this.links){for(const t of this.links)t.destroy();this.links.length=0}return d.destroy.apply(this,arguments)}pointAttribs(t,e){var i=this.mapOptionsToLevel[t.node.level||0]||{},s=t.options,o=i.states&&i.states[e]||{},r=(t.options.marker=m(this.options.marker,i.marker,t.options.marker),k(o.link&&o.link.color,s.link&&s.link.color,i.link&&i.link.color,this.options.link&&this.options.link.color)),i=k(o.link&&o.link.lineWidth,s.link&&s.link.lineWidth,i.link&&i.link.lineWidth,this.options.link&&this.options.link.lineWidth);return e=d.pointAttribs.call(this,t,e),t.isLink&&(e.stroke=r,e["stroke-width"]=i,delete e.fill),t.visible||(e.opacity=0),e}drawPoints(){p.prototype.drawPoints.apply(this,arguments),c.prototype.drawPoints.call(this,this.links)}translateNode(t){const e=this.chart;var i=t.node;const s=e.plotSizeY,o=e.plotSizeX,{ax:r,bx:n,ay:a,by:l}=this.layoutModifier;var h=r*i.xPosition+n,d=a*i.yPosition+l,p=this.mapOptionsToLevel[i.level]||{},c=m(this.options.marker,p.marker,t.options.marker).symbol,u=i.nodeSizeY,f=i.nodeSizeX,g=this.options.reversed,h=i.x=e.inverted?o-f/2-h:h-f/2,i=i.y=g?d-u/2:s-d-u/2,p=k(t.options.borderRadius,p.borderRadius,this.options.borderRadius);if(t.shapeType="path",!t.visible&&t.linkToParent){if(d=t.linkToParent.fromNode){const{x:i=0,y:e=0,width:s=0,height:o=0}=d.shapeArgs||{};t.shapeArgs||(t.shapeArgs={}),y(t.shapeArgs,{d:v[c||"circle"](i,e,s,o,p?{r:p}:void 0),x:i,y:e}),t.plotX=d.plotX,t.plotY=d.plotY}}else t.plotX=h,t.plotY=i,t.shapeArgs={d:v[c||"circle"](h,i,f,u,p?{r:p}:void 0),x:h,y:i,width:f,height:u,cursor:t.node.isLeaf?"default":"pointer"};t.tooltipPos=e.inverted?[s-i-u/2,o-h-f/2]:[h+f/2,i]}}return L.defaultOptions=m(p.defaultOptions,h),y(L.prototype,{pointClass:o,NodeClass:s,LinkClass:a}),e.registerSeriesType("treegraph",L),L}),e(t,"masters/modules/treegraph.src.js",[],function(){})});