!function(o){"object"==typeof module&&module.exports?module.exports=o.default=o:"function"==typeof define&&define.amd?define("highcharts/modules/sankey",["highcharts"],function(t){return o(t),o.Highcharts=t,o}):o("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(t){"use strict";t=t?t._modules:{};function o(t,o,e,i){t.hasOwnProperty(o)||(t[o]=i.apply(null,e),"function"==typeof CustomEvent&&window.dispatchEvent(new CustomEvent("HighchartsModuleLoaded",{detail:{path:o,module:t[o]}})))}o(t,"Series/NodesComposition.js",[t["Core/Series/SeriesRegistry.js"],t["Core/Utilities.js"]],function(t,s){const{prototype:i,prototype:{pointClass:{prototype:l}}}=t["series"],{defined:n,extend:r,find:a,merge:d,pick:h}=s;var o;{t=o=o||{};const f=[];function p(){return this.data=[].concat(this.points||[],this.nodes),i.destroy.apply(this,arguments)}function c(){this.nodes&&(this.nodes.forEach(t=>{t.destroy()}),this.nodes.length=0),i.setData.apply(this,arguments)}function u(t){const o=arguments,e=this.isNode?this.linksTo.concat(this.linksFrom):[this.fromNode,this.toNode];"select"!==t&&e.forEach(t=>{t&&t.series&&(l.setState.apply(t,o),t.isNode||(t.fromNode.graphic&&l.setState.apply(t.fromNode,o),t.toNode&&t.toNode.graphic&&l.setState.apply(t.toNode,o)))}),l.setState.apply(this,o)}function m(t,o,e,i){const s=this.series.options.nodes,n=this.series.options.data,r=n&&n.length||0,a=n&&n[this.index];l.update.call(this,t,!this.isNode&&o,e,i),this.isNode&&(t=(s||[]).reduce((t,o,e)=>this.id===o.id?e:t,-1),i=d(s&&s[t]||{},n&&n[this.index]||{}),n&&(a?n[this.index]=a:n.length=r),s?0<=t?s[t]=i:s.push(i):this.series.options.nodes=[i],h(o,!0)&&this.series.chart.redraw(e))}t.compose=function(t,o){if(s.pushUnique(f,t)){const e=t.prototype;e.setNodeState=u,e.setState=u,e.update=m}if(s.pushUnique(f,o)){const i=o.prototype;i.destroy=p,i.setData=c}return o},t.createNode=function(t){const o=this.pointClass,e=(t,o)=>a(t,t=>t.id===o);let i=e(this.nodes,t),s;if(!i){s=this.options.nodes&&e(this.options.nodes,t);const n=(new o).init(this,r({className:"highcharts-node",isNode:!0,id:t,y:1},s));n.linksTo=[],n.linksFrom=[],n.getSum=function(){let o=0,e=0;return n.linksTo.forEach(t=>{o+=t.weight||0}),n.linksFrom.forEach(t=>{e+=t.weight||0}),Math.max(o,e)},n.offset=function(o,e){let i=0;for(let t=0;t<n[e].length;t++){if(n[e][t]===o)return i;i+=n[e][t].weight}},n.hasShape=function(){let o=0;return n.linksTo.forEach(t=>{t.outgoing&&o++}),!n.linksTo.length||o!==n.linksTo.length},n.index=this.nodes.push(n)-1,i=n}return i.formatPrefix="node",i.name=i.name||i.options.id||"",i.mass=h(i.options.mass,i.options.marker&&i.options.marker.radius,this.options.marker&&this.options.marker.radius,4),i},t.destroy=p,t.generatePoints=function(){const o=this.chart,e={};i.generatePoints.call(this),this.nodes||(this.nodes=[]),this.colorCounter=0,this.nodes.forEach(t=>{t.linksFrom.length=0,t.linksTo.length=0,t.level=t.options.level}),this.points.forEach(t=>{n(t.from)&&(e[t.from]||(e[t.from]=this.createNode(t.from)),e[t.from].linksFrom.push(t),t.fromNode=e[t.from],o.styledMode?t.colorIndex=h(t.options.colorIndex,e[t.from].colorIndex):t.color=t.options.color||e[t.from].color),n(t.to)&&(e[t.to]||(e[t.to]=this.createNode(t.to)),e[t.to].linksTo.push(t),t.toNode=e[t.to]),t.name=t.name||t.id},this),this.nodeLookup=e},t.setNodeState=u,t.updateNode=m}return o}),o(t,"Series/Sankey/SankeyPoint.js",[t["Core/Series/Point.js"],t["Core/Series/SeriesRegistry.js"],t["Core/Utilities.js"]],function(e,t,o){var t=t["seriesTypes"]["column"];const i=o["defined"];class s extends t.prototype.pointClass{constructor(){super(...arguments),this.className=void 0,this.fromNode=void 0,this.level=void 0,this.linkBase=void 0,this.linksFrom=void 0,this.linksTo=void 0,this.mass=void 0,this.nodeX=void 0,this.nodeY=void 0,this.options=void 0,this.series=void 0,this.toNode=void 0}applyOptions(t,o){return e.prototype.applyOptions.call(this,t,o),i(this.options.level)&&(this.options.column=this.column=this.options.level),this}getClassName(){return(this.isNode?"highcharts-node ":"highcharts-link ")+e.prototype.getClassName.call(this)}getFromNode(){let o=-1,e;for(let t=0;t<this.linksTo.length;t++){var i=this.linksTo[t];i.fromNode.column>o&&i.fromNode!==this&&(e=i.fromNode,o=e.column)}return{fromNode:e,fromColumn:o}}setNodeColumn(){var t=this;i(t.options.column)||(0===t.linksTo.length?t.column=0:t.column=t.getFromNode().fromColumn+1)}isValid(){return this.isNode||"number"==typeof this.weight}}return s}),o(t,"Series/Sankey/SankeySeriesDefaults.js",[],function(){return{borderWidth:0,colorByPoint:!0,curveFactor:.33,dataLabels:{enabled:!0,backgroundColor:"none",crop:!1,nodeFormat:void 0,nodeFormatter:function(){return this.point.name},format:void 0,formatter:function(){},inside:!0},inactiveOtherPoints:!0,linkOpacity:.5,opacity:1,minLinkWidth:0,nodeWidth:20,nodePadding:10,showInLegend:!1,states:{hover:{linkOpacity:1,opacity:1},inactive:{linkOpacity:.1,opacity:.1,animation:{duration:50}}},tooltip:{followPointer:!0,headerFormat:'<span style="font-size: 0.8em">{series.name}</span><br/>',pointFormat:"{point.fromNode.name} â†’ {point.toNode.name}: <b>{point.weight}</b><br/>",nodeFormat:"{point.name}: <b>{point.sum}</b><br/>"}}}),o(t,"Series/Sankey/SankeyColumnComposition.js",[t["Core/Utilities.js"]],function(t){const{defined:c,relativeLength:u}=t;var o;{(t=o=o||{}).compose=function(t,o){const e=t;return e.sankeyColumn=new i(e,o),e};class i{constructor(t,o){this.points=t,this.series=o}getTranslationFactor(t){const o=this.points,e=o.slice(),i=t.chart,s=t.options.minLinkWidth||0;let n,r=0,a,l=(i.plotSizeY||0)-(t.options.borderWidth||0)-(o.length-1)*t.nodePadding;for(;o.length;){for(r=l/o.sankeyColumn.sum(),n=!1,a=o.length;a--;)o[a].getSum()*r<s&&(o.splice(a,1),l-=s,n=!0);if(!n)break}return o.length=0,e.forEach(t=>{o.push(t)}),r}top(e){const i=this.series,s=i.nodePadding;var t=this.points.reduce(function(t,o){return 0<t&&(t+=s),t+=Math.max(o.getSum()*e,i.options.minLinkWidth||0)},0);return((i.chart.plotSizeY||0)-t)/2}left(e){const i=this.series,t=i.chart,s=i.options.equalNodes,n=t.inverted?t.plotHeight:t.plotWidth,r=i.nodePadding;var o=this.points.reduce(function(t,o){return 0<t&&(t+=r),t+=s?n/o.series.nodes.length-r:Math.max(o.getSum()*e,i.options.minLinkWidth||0)},0);return((t.plotSizeX||0)-Math.round(o))/2}sum(){return this.points.reduce(function(t,o){return t+o.getSum()},0)}offset(o,e){const i=this.points,s=this.series,n=s.nodePadding;let r=0,a;if(s.is("organization")&&o.hangsFrom)return{absoluteTop:o.hangsFrom.nodeY};for(let t=0;t<i.length;t++){var l=i[t].getSum(),d=Math.max(l*e,s.options.minLinkWidth||0),h=o.options[s.chart.inverted?"offsetHorizontal":"offsetVertical"],p=o.options.offset||0;if(a=l?d+n:0,i[t]===o)return{relativeTop:r+(c(h)?u(h,d):u(p,a))};r+=a}}}t.SankeyColumnAdditions=i}return o}),o(t,"Series/TreeUtilities.js",[t["Core/Color/Color.js"],t["Core/Utilities.js"]],function(y,t){const{extend:m,isArray:l,isNumber:d,isObject:h,merge:p,pick:k}=t;return{getColor:function(t,o){const e=o.index,i=o.mapOptionsToLevel,s=o.parentColor,n=o.parentColorIndex,r=o.series,a=o.colors,l=o.siblings,d=r.points,h=r.chart.options.chart;let p,c,u,m,f,g;var v;return t&&(p=d[t.i],c=i[t.level]||{},p&&c.colorByPoint&&(m=p.index%(a?a.length:h.colorCount),u=a&&a[m]),r.chart.styledMode||(f=k(p&&p.options.color,c&&c.color,u,s&&(t=s,(v=c&&c.colorVariation)&&"brightness"===v.key&&e&&l?y.parse(t).brighten(v.to*(e/l)).get():t),r.color)),g=k(p&&p.options.colorIndex,c&&c.colorIndex,m,n,o.colorIndex)),{color:f,colorIndex:g}},getLevelOptions:function(t){let o={},n,e,i,r,s,a;if(h(t))for(r=d(t.from)?t.from:1,a=t.levels,e={},n=h(t.defaults)?t.defaults:{},l(a)&&(e=a.reduce((t,o)=>{let e,i,s;return h(o)&&d(o.level)&&(s=p({},o),i=k(s.levelIsConstant,n.levelIsConstant),delete s.levelIsConstant,delete s.level,e=o.level+(i?0:r-1),h(t[e])?p(!0,t[e],s):t[e]=s),t},{})),s=d(t.to)?t.to:1,i=0;i<=s;i++)o[i]=p({},n,h(e[i])?e[i]:{});return o},setTreeValues:function i(s,n){const t=n.before,o=n.idRoot,e=n.mapIdToNode,r=e[o],a=!1!==n.levelIsConstant,l=n.points,d=l[s.i],h=d&&d.options||{},p=[];let c=0;s.levelDynamic=s.level-(a?0:r.level),s.name=k(d&&d.name,""),s.visible=o===s.id||!0===n.visible,(s="function"==typeof t?t(s,n):s).children.forEach((t,o)=>{var e=m({},n);m(e,{index:o,siblings:s.children.length,visible:s.visible}),t=i(t,e),p.push(t),t.visible&&(c+=t.val)});var u=k(h.value,c);return s.visible=0<=u&&(0<c||s.visible),s.children=p,s.childrenTotal=c,s.isLeaf=s.visible&&!c,s.val=u,s},updateRootId:function(t){let o,e;return h(t)&&(e=h(t.options)?t.options:{},o=k(t.rootNode,e.rootId,""),h(t.userOptions)&&(t.userOptions.rootId=o),t.rootNode=o),o}}}),o(t,"Series/Sankey/SankeySeries.js",[t["Core/Color/Color.js"],t["Core/Globals.js"],t["Series/NodesComposition.js"],t["Series/Sankey/SankeyPoint.js"],t["Series/Sankey/SankeySeriesDefaults.js"],t["Core/Series/SeriesRegistry.js"],t["Series/Sankey/SankeyColumnComposition.js"],t["Series/TreeUtilities.js"],t["Core/Utilities.js"]],function(d,t,e,o,i,s,n,r,a){const{series:l,seriesTypes:{column:h}}=s,p=r["getLevelOptions"],{extend:c,isObject:u,merge:m,pick:f,relativeLength:g,stableSort:v}=a;class y extends h{constructor(){super(...arguments),this.colDistance=void 0,this.data=void 0,this.group=void 0,this.nodeLookup=void 0,this.nodePadding=void 0,this.nodes=void 0,this.nodeWidth=void 0,this.options=void 0,this.points=void 0,this.translationFactor=void 0}static getDLOptions(t){var o=u(t.optionsPoint)?t.optionsPoint.dataLabels:{},t=u(t.level)?t.level.dataLabels:{};return m({style:{}},t,o)}createNodeColumns(){const o=[];this.nodes.forEach(function(t){t.setNodeColumn(),o[t.column]||(o[t.column]=n.compose([],this)),o[t.column].push(t)},this);for(let t=0;t<o.length;t++)void 0===o[t]&&(o[t]=n.compose([],this));return o}order(t,o){const e=this;void 0===t.level&&(t.level=o,t.linksFrom.forEach(function(t){t.toNode&&e.order(t.toNode,o+1)}))}generatePoints(){e.generatePoints.apply(this,arguments);const o=this;this.orderNodes&&(this.nodes.filter(function(t){return 0===t.linksTo.length}).forEach(function(t){o.order(t,0)}),v(this.nodes,function(t,o){return t.level-o.level}))}getNodePadding(){let t=this.options.nodePadding||0;var o;return t=this.nodeColumns&&(o=this.nodeColumns.reduce((t,o)=>Math.max(t,o.length),0))*t>this.chart.plotSizeY?this.chart.plotSizeY/o:t}hasData(){return!!this.processedXData.length}pointAttribs(t,o){if(!t)return{};const e=this,i=(t.isNode?t:t.fromNode).level,s=e.mapOptionsToLevel[i||0]||{},n=t.options,r=s.states&&s.states[o||""]||{},a=["colorByPoint","borderColor","borderWidth","linkOpacity","opacity"].reduce(function(t,o){return t[o]=f(r[o],n[o],s[o],e.options[o]),t},{}),l=f(r.color,n.color,(a.colorByPoint?t:s).color);return t.isNode?{fill:l,stroke:a.borderColor,"stroke-width":a.borderWidth,opacity:a.opacity}:{fill:d.parse(l).setOpacity(a.linkOpacity).get()}}drawTracker(){h.prototype.drawTracker.call(this,this.points),h.prototype.drawTracker.call(this,this.nodes)}drawPoints(){h.prototype.drawPoints.call(this,this.points),h.prototype.drawPoints.call(this,this.nodes)}drawDataLabels(){h.prototype.drawDataLabels.call(this,this.points),h.prototype.drawDataLabels.call(this,this.nodes)}translate(){this.processedXData||this.processData(),this.generatePoints(),this.nodeColumns=this.createNodeColumns(),this.nodeWidth=g(this.options.nodeWidth,this.chart.plotSizeX);const e=this,t=this.chart,o=this.options,i=this.nodeWidth,s=this.nodeColumns;this.nodePadding=this.getNodePadding(),this.translationFactor=s.reduce((t,o)=>Math.min(t,o.sankeyColumn.getTranslationFactor(e)),1/0),this.colDistance=(t.plotSizeX-i-o.borderWidth)/Math.max(1,s.length-1),e.mapOptionsToLevel=p({from:1,levels:o.levels,to:s.length-1,defaults:{borderColor:o.borderColor,borderRadius:o.borderRadius,borderWidth:o.borderWidth,color:e.color,colorByPoint:o.colorByPoint,levelIsConstant:!0,linkColor:o.linkColor,linkLineWidth:o.linkLineWidth,linkOpacity:o.linkOpacity,states:o.states}}),s.forEach(function(o){o.forEach(function(t){e.translateNode(t,o)})},this),this.nodes.forEach(function(t){t.linksFrom.forEach(function(t){(t.weight||t.isNull)&&t.to&&(e.translateLink(t),t.allowShadow=!1)})})}translateLink(e){var t,o,i,s,n,r,a,l,d,h,p,c,u,m,f,g,v,y,k=(t,o)=>{o=t.offset(e,o)*b;return Math.min(t.nodeY+o,t.nodeY+(t.shapeArgs&&t.shapeArgs.height||0)-L)};let C=e.fromNode,S=e.toNode,N=this.chart,b=this.translationFactor,L=Math.max(e.weight*b,this.options.minLinkWidth),x=this.options,T=(N.inverted?-this.colDistance:this.colDistance)*x.curveFactor,P=k(C,"linksFrom"),w=k(S,"linksTo"),j=C.nodeX,O=this.nodeWidth,F=S.nodeX,W=e.outgoing,M=F>j+O;N.inverted&&(P=N.plotSizeY-P,w=(N.plotSizeY||0)-w,O=-O,L=-L,M=F<j),e.shapeType="path",e.linkBase=[P,P+L,w,w+L],M&&"number"==typeof w?e.shapeArgs={d:[["M",j+O,P],["C",j+O+T,P,F-T,w,F,w],["L",F+(W?O:0),w+L/2],["L",F,w+L],["C",F-T,w+L,j+O+T,P+L,j+O,P+L],["Z"]]}:"number"==typeof w&&(k=N.plotHeight-P-L,t=F-20-L,o=F-20,n=(s=(i=j+O)+20)+L,h=(d=(k=(l=(a=(r=P)+L)+20)+k)+20)+L,u=(c=(p=w)+L)+20,m=a-.7*L,f=d+.7*L,g=c-.7*L,v=F-.7*L,y=i+.7*L,e.shapeArgs={d:[["M",i,r],["C",y,r,n,m,n,l],["L",n,k],["C",n,f,y,h,i,h],["L",F,h],["C",v,h,t,f,t,k],["L",t,u],["C",t,g,v,p,F,p],["L",F,c],["C",o,c,o,c,o,u],["L",o,k],["C",o,d,o,d,F,d],["L",i,d],["C",s,d,s,d,s,k],["L",s,l],["C",s,a,s,a,i,a],["Z"]]}),e.dlBox={x:j+(F-j+O)/2,y:P+(w-P)/2,height:L,width:0},e.tooltipPos=N.inverted?[N.plotSizeY-e.dlBox.y-L/2,N.plotSizeX-e.dlBox.x]:[e.dlBox.x,e.dlBox.y+L/2],e.y=e.plotY=1,e.x=e.plotX=1,e.color||(e.color=C.color)}translateNode(s,n){var t=this.translationFactor,r=this.chart,a=this.options,{borderRadius:l,borderWidth:d=0}=a,o=s.getSum(),h=Math.max(Math.round(o*t),this.options.minLinkWidth),p=Math.round(this.nodeWidth),e=Math.round(d)%2/2,c=n.sankeyColumn.offset(s,t),n=Math.floor(f(c.absoluteTop,n.sankeyColumn.top(t)+c.relativeTop))+e,t=Math.floor(this.colDistance*s.column+d/2)+g(s.options.offsetHorizontal||0,p)+e,c=r.inverted?r.plotSizeX-t:t;if(s.sum=o){s.shapeType="roundedRect";let t=s.nodeX=c,o=s.nodeY=n,e=s.options.width||a.width||p,i=s.options.height||a.height||h;d=g("object"==typeof l?l.radius:l||0,e);r.inverted&&(t=c-p,o=r.plotSizeY-n-h,e=s.options.height||a.height||p,i=s.options.width||a.width||h),s.dlOptions=y.getDLOptions({level:this.mapOptionsToLevel[s.level],optionsPoint:s.options}),s.plotX=1,s.plotY=1,s.tooltipPos=r.inverted?[r.plotSizeY-o-i/2,r.plotSizeX-t-e/2]:[t+e/2,o+i/2],s.shapeArgs={x:t,y:o,width:e,height:i,r:d,display:s.hasShape()?"":"none"}}else s.dlOptions={enabled:!1}}}return y.defaultOptions=m(h.defaultOptions,i),e.compose(o,y),c(y.prototype,{animate:l.prototype.animate,createNode:e.createNode,forceDL:!0,invertible:!0,isCartesian:!1,orderNodes:!0,noSharedTooltip:!0,pointArrayMap:["from","to","weight"],pointClass:o,searchPoint:t.noop}),s.registerSeriesType("sankey",y),y}),o(t,"masters/modules/sankey.src.js",[],function(){})});